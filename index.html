<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å‘½ãƒ»é‹ãƒ»åœï½œæ•°ç§˜ï¼‹å®¿æ›œ ãƒ—ãƒ­å ã„</title>
<style>
  :root{
    --bg:#0a0f13; --panel:#121922; --ink:#e8f0ff; --muted:#93a4c8;
    --accent:#2dd4bf; --accent2:#60a5fa; --bad:#f87171; --good:#34d399;
    --warn:#fbbf24;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;background:linear-gradient(180deg,#05080c,#0a0f13 40%,#0a0f13);color:var(--ink)}
  header{padding:24px 16px;text-align:center}
  header h1{margin:0 0 6px;font-size:24px;letter-spacing:.05em}
  header p{margin:0;color:var(--muted)}
  main{max-width:1100px;margin:0 auto;padding:12px 16px 80px}
  .card{background:var(--panel);border:1px solid #1e293b;border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .grid{display:grid;gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:2fr 3fr}}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input,select,button,textarea{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid #223049;background:#0b1320;color:var(--ink)
  }
  button{cursor:pointer;background:linear-gradient(45deg,var(--accent),var(--accent2));border:none;font-weight:600}
  .pill{display:inline-block;border:1px solid #253448;padding:2px 8px;border-radius:999px;margin-right:6px;color:var(--muted);font-size:12px}
  h2{margin:0 0 8px;font-size:18px}
  h3{margin:12px 0 6px;font-size:16px}
  .kpi{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
  .kpi div{background:#0d1524;border:1px solid #293449;padding:8px 12px;border-radius:10px}
  .badge{font-weight:700}
  .muted{color:var(--muted)}
  .good{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-bottom:1px dashed #243040;padding:8px 6px;text-align:left;font-size:13px}
  th{color:#a8c1ff}
  .calendar{display:grid;gap:10px}
  @media(min-width:900px){.calendar{grid-template-columns:repeat(3,1fr)}}
  .mon{border:1px solid #203047;border-radius:12px;padding:10px;background:#0b1320}
  .tag{display:inline-block;font-size:11px;border:1px solid #2b3c55;border-radius:6px;padding:1px 6px;margin-right:4px;margin-bottom:4px}
  .t-good{border-color:#14532d;color:#34d399}
  .t-warn{border-color:#7c4a03;color:#fbbf24}
  .t-bad{border-color:#5b2323;color:#f87171}
  .small{font-size:12px}
  .footer{color:var(--muted);font-size:12px;line-height:1.6}
  .hl{background:linear-gradient(90deg,rgba(45,212,191,.15),transparent);padding:2px 4px;border-radius:6px}
</style>
</head>
<body>
<header>
  <h1>å‘½ãƒ»é‹ãƒ»åœã€€çµ±åˆãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</h1>
  <p>ç”Ÿå¹´æœˆæ—¥ï¼ˆï¼‹ä»»æ„ï¼šå‡ºç”Ÿæ™‚åˆ»/ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼‰ã ã‘ã§ã€<span class="hl">æ•°ç§˜è¡“ï¼‹å®¿æ›œ</span>ã‚’è‡ªå‹•è§£æã€‚3å¹´é–“ã®å¥½æ©Ÿã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä»˜ãã€‚</p>
</header>
<main>
  <div class="card grid">
    <div>
      <label>ç”Ÿå¹´æœˆæ—¥</label>
      <input type="date" id="birth" />
      <div style="display:flex;gap:10px;margin-top:8px">
        <div style="flex:1">
          <label>å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï½œä¸æ˜ãªã‚‰ç©ºï¼‰</label>
          <input type="time" id="btime" step="60" />
        </div>
        <div style="flex:1">
          <label>ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼ˆä»»æ„ï½œæœªæŒ‡å®š=ã‚ãªãŸã®ç’°å¢ƒï¼‰</label>
          <select id="tz">
            <option value="">è‡ªå‹•ï¼ˆç«¯æœ«ã®TZï¼‰</option>
            <option value="9">JSTï¼ˆUTC+9ï¼‰</option>
            <option value="0">UTCÂ±0</option>
            <option value="-5">NYï¼ˆUTC-5ï¼‰</option>
            <option value="1">CETï¼ˆUTC+1ï¼‰</option>
          </select>
        </div>
      </div>
      <div style="margin-top:8px">
        <label>æ€§åˆ¥ï¼ˆä»»æ„ï½œè§£èª¬ã®èªã‚Šå£ã«ä½¿ç”¨ï¼‰</label>
        <select id="gender">
          <option value="">æŒ‡å®šãªã—</option>
          <option value="female">å¥³æ€§</option>
          <option value="male">ç”·æ€§</option>
        </select>
      </div>
      <div style="margin-top:12px">
        <button id="run">é‘‘å®šã™ã‚‹</button>
      </div>
      <p class="small muted" style="margin-top:8px">
        â€»å®¿æ›œã¯æœˆé»„çµŒï¼ˆæœˆã®é»„çµŒï¼‰ã‹ã‚‰27å®¿ã‚’å‰²ã‚Šå‡ºã™é«˜ç²¾åº¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆMeeusç°¡æ˜“å¼ãƒ™ãƒ¼ã‚¹ï¼‰ã‚’ä½¿ç”¨ã€‚å‡ºç”Ÿæ™‚åˆ»ä¸æ˜ã®å ´åˆã¯ã€Œæ­£åˆã€ã§æ¨å®šã—ã¾ã™ã€‚
      </p>
    </div>
    <div>
      <div class="kpi">
        <div><span class="badge">ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹</span>ï¼š<span id="lifePath">â€”</span></div>
        <div><span class="badge">27å®¿</span>ï¼š<span id="shuku">â€”</span></div>
        <div><span class="badge">æœ¬å¹´ã®å€‹äººå¹´</span>ï¼š<span id="pyear">â€”</span></div>
      </div>
      <div class="muted small">çµæœã¯ä¸‹ã®å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚å†…å®¹ã¯ãã®ã¾ã¾ãŠå®¢æ§˜å‘ã‘ã®æ–‡ç« ã¨ã—ã¦ã‚³ãƒ”ãƒšå¯èƒ½ã§ã™ã€‚</div>
    </div>
  </div>

  <div class="card">
    <h2>â‘  å‘½ï¼ˆã‚ã„ï¼‰ï½œæœ¬è³ªãƒ»æ€§æ ¼ãƒ»å®¿å‘½</h2>
    <div id="sectionMei" class="muted">å…¥åŠ›å¾Œã«è¡¨ç¤ºã€‚</div>
  </div>

  <div class="card">
    <h2>â‘¡ é‹ï¼ˆã†ã‚“ï¼‰ï½œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ»æµã‚Œ</h2>
    <div id="sectionUn" class="muted">å…¥åŠ›å¾Œã«è¡¨ç¤ºã€‚</div>
  </div>

  <div class="card">
    <h2>â‘¢ åœï¼ˆã¼ãï¼‰ï½œä»Šã®å¿ƒãƒ»åˆ†å²ç‚¹ï¼ˆç°¡æ˜“ï¼‰</h2>
    <div id="sectionBoku" class="muted">ã€Œä»Šã®ãƒ†ãƒ¼ãƒã€ã‚’æ•°ç§˜ã®ã‚µã‚¤ã‚¯ãƒ«ã‹ã‚‰è¨€èªåŒ–ã—ã¾ã™ã€‚</div>
  </div>

  <div class="card">
    <h2>ğŸ”­ 3å¹´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï½œæ‹æ„›ãƒ»çµå©šãƒ»å‡ºä¼šã„ãƒ»å¼•è¶Šã—ãƒ»è»¢è·</h2>
    <div class="small muted">â€»æ•°ç§˜ã®å€‹äººå¹´ãƒ»å€‹äººæœˆã‚µã‚¤ã‚¯ãƒ«ã‹ã‚‰â€œå‹•ãã‚„ã™ã„æœˆï¼æ•´ãˆã‚‹æœˆâ€ã‚’è‰²åˆ†ã‘ã€‚å®¿æ›œã®å‰å‡¶ï¼ˆå®‰ãƒ»æ „ãƒ»æˆãƒ»å±â€¦ï¼‰ã‚’è£œåŠ©ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦åŠ ç‚¹ã€‚</div>
    <div id="calendar" class="calendar" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <h2>è·æ¥­é©æ€§ãƒ»æƒ¹ã‹ã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒ—ï¼ˆé•·æ–‡ï¼‰</h2>
    <div id="sectionCareerLove" class="muted">å…¥åŠ›å¾Œã«è¡¨ç¤ºã€‚</div>
  </div>

  <div class="footer card">
    <h3>å…è²¬ã¨ä½¿ã„æ–¹</h3>
    <p>
      æœ¬ãƒ„ãƒ¼ãƒ«ã¯ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°è£œåŠ©ã‚’ç›®çš„ã¨ã—ãŸãƒ—ãƒ­å‘ã‘ãƒ†ãƒ³ãƒ—ãƒ¬ã§ã™ã€‚åŒ»å­¦ãƒ»æ³•å‹™ãƒ»æŠ•è³‡åˆ¤æ–­ã®ä»£æ›¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br/>
      å®¿æ›œã¯å¤©æ–‡è¨ˆç®—ã®ç°¡æ˜“å¼ã‚’æ¡ç”¨ã—ã€å®Ÿå‹™ä¸Šã¯ååˆ†ãªç²¾åº¦ã§ã™ãŒâ€œåˆ†ã€œ1åº¦â€å˜ä½ã®èª¤å·®ãŒæ®‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å‡ºç”Ÿæ™‚åˆ»ãŒä¸æ˜ã®ã¨ãã¯Â±12æ™‚é–“ã®æœˆç§»å‹•ã«ã‚ˆã‚Šå®¿ãŒå¤‰ã‚ã‚‹ä¾‹ã‚‚ã‚ã‚‹ãŸã‚ã€é‡è¦æ¡ˆä»¶ã¯ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™ã€‚
    </p>
  </div>
</main>

<script>
/* ---------- æ•°å­¦ãƒ»æš¦ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
const deg2rad = d => d * Math.PI/180;
const rad2deg = r => r * 180/Math.PI;
const norm360 = x => (x%360+360)%360;

function toDateWithTZ(birthStr, timeStr, tzHours){
  // birthStr: "YYYY-MM-DD", timeStr: "HH:MM" or "", tzHours: number|null
  const [y,m,d] = birthStr.split("-").map(Number);
  let H=12, MIN=0;
  if (timeStr) { const t=timeStr.split(":"); H=+t[0]; MIN=+t[1]; }
  // if tzHours not given, use current TZ offset
  const tz = (tzHours!==null && tzHours!==undefined && !Number.isNaN(+tzHours)) ? (+tzHours) : -(new Date().getTimezoneOffset()/60);
  // construct UTC time = local - tz
  const date = new Date(Date.UTC(y,m-1,d,H - tz, MIN));
  return {dateUTC:date, tzHours:tz};
}

function julianDay(dateUTC){
  // Meeus: JD from UTC date (not TT) â€“ååˆ†ãªç²¾åº¦
  const y = dateUTC.getUTCFullYear();
  const m = dateUTC.getUTCMonth()+1;
  const D = dateUTC.getUTCDate() + (dateUTC.getUTCHours()+dateUTC.getUTCMinutes()/60)/24;
  let A=y, B=m;
  let Y=y, M=m;
  if(M<=2){Y-=1; M+=12;}
  const A2 = Math.floor(Y/100);
  const B2 = 2 - A2 + Math.floor(A2/4);
  const JD = Math.floor(365.25*(Y+4716)) + Math.floor(30.6001*(M+1)) + D + B2 - 1524.5;
  return JD;
}

/* ---------- æœˆã®é»„çµŒï¼ˆMeeusç°¡æ˜“å¼ï¼‰â†’27å®¿ ---------- */
// å……åˆ†ã«å®Ÿå‹™ã§ä½¿ãˆã‚‹ç²¾åº¦ï¼ˆèª¤å·®~0.5Â°ç¨‹åº¦ï¼‰ã‚’ç›®æ¨™ã«ä¸»è¦é …ã ã‘æ¡ç”¨
function moonEclipticLongitude(dateUTC){
  const JD = julianDay(dateUTC);
  const T = (JD - 2451545.0)/36525.0;
  const L0 = norm360(218.3164477 + 481267.88123421*T - 0.0015786*T*T + T*T*T/538841 - T*T*T*T/65194000);
  const D  = norm360(297.8501921 + 445267.1114034*T - 0.0018819*T*T + T*T*T/545868 - T*T*T*T/113065000);
  const M  = norm360(357.5291092 + 35999.0502909*T - 0.0001536*T*T + T*T*T/24490000);
  const M1 = norm360(134.9633964 + 477198.8675055*T + 0.0087414*T*T + T*T*T/69699 - T*T*T*T/14712000);
  const F  = norm360(93.2720950  + 483202.0175233*T - 0.0036539*T*T - T*T*T/3526000 + T*T*T*T/863310000);

  // æ‘‚å‹•ã®ä¸»è¦é …ï¼ˆè§’åº¦ã¯åº¦â†’ãƒ©ã‚¸ã‚¢ãƒ³ï¼‰
  let lon = L0
    + 6.289 * Math.sin(deg2rad(M1))
    + 1.274 * Math.sin(deg2rad(2*D - M1))
    + 0.658 * Math.sin(deg2rad(2*D))
    + 0.214 * Math.sin(deg2rad(2*M1))
    + 0.186 * Math.sin(deg2rad(M))
    - 0.114 * Math.sin(deg2rad(2*F))
    + 0.059 * Math.sin(deg2rad(2*D - 2*M1))
    + 0.057 * Math.sin(deg2rad(2*D - M - M1))
    + 0.053 * Math.sin(deg2rad(2*D + M1))
    + 0.046 * Math.sin(deg2rad(2*D - M))
    + 0.041 * Math.sin(deg2rad(M - M1))
    - 0.035 * Math.sin(deg2rad(D))
    - 0.031 * Math.sin(deg2rad(M + M1))
    - 0.015 * Math.sin(deg2rad(2*F - 2*D));
  return norm360(lon);
}

const SHUKU = [
  "è§’æœ¨è›Ÿ","äº¢é‡‘é¾","æ°åœŸè²‰","æˆ¿æ—¥å…","å¿ƒæœˆç‹","å°¾ç«è™","ç®•æ°´è±¹",
  "æ–—æœ¨ç¬","å¥³åœŸè ","è™šæ—¥é¼ ","å±æœˆç‡•","å®¤ç«çŒª","å£æ°´è²",
  "å¥æœ¨ç‹¼","å©é‡‘ç‹—","èƒƒåœŸé›‰","æ˜´æ—¥éµ ","ç•¢æœˆçƒ","è§œç«çŒ´","å‚æ°´çŒ¿",
  "äº•æœ¨çŠ´","é¬¼é‡‘ç¾Š","æŸ³åœŸç","æ˜Ÿæ—¥é¦¬","å¼µæœˆé¹¿","ç¿¼ç«è›‡","è»«æ°´èš“"
];

const SHUKU_PROFILE = {
  "è§’æœ¨è›Ÿ":{type:"å’Œå–„",keywords:"å§‹å‹•ãƒ»å‰µé€ ãƒ»ç™ºå±•", love:"æƒ…ã§å‹•ãã€‚ç›¸æ‰‹ã®æˆé•·ã‚’æ”¯ãˆåˆã†é–¢ä¿‚ã‚’å¥½ã‚€ã€‚", career:"ã‚¼ãƒ­â†’ã‚¤ãƒã€‚å–¶æ¥­/èµ·æ¥­/ä¼ç”»/é–‹ç™ºã€‚"},
  "äº¢é‡‘é¾":{type:"å’Œå–„",keywords:"çŸœæŒãƒ»æ­£ç¾©ãƒ»è«–ç†", love:"ãƒ—ãƒ©ã‚¤ãƒ‰é«˜ã‚ã€‚å°Šæ•¬ã§ãã‚‹çŸ¥æ€§ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", career:"æ³•å‹™/äº¤æ¸‰/ã‚³ãƒ³ã‚µãƒ«/æ•™è‚²ã€‚"},
  "æ°åœŸè²‰":{type:"å’Œå–„",keywords:"æ•´ãˆã‚‹ãƒ»èª¿æ•´å½¹", love:"ç©ã‚„ã‹ã§å®¶åº­çš„ã€‚å®‰å®šå¿—å‘ã®ç›¸æ‰‹â—", career:"äº‹å‹™/çµŒç†/ç·¨é›†/èª¿æ•´å‹PMã€‚"},
  "æˆ¿æ—¥å…":{type:"å’Œå–„",keywords:"äººæ°—ãƒ»è¯ãƒ»å¯æ„›ã’", love:"æ„›ã•ã‚Œä½“è³ªã€‚æ¥½ã—ã„äºº/è¦‹ãŸç›®â—ã«å¼±ã„ã€‚", career:"æ¥å®¢/ç¾å®¹/ã‚¨ãƒ³ã‚¿ãƒ¡/åºƒå ±ã€‚"},
  "å¿ƒæœˆç‹":{type:"å’Œå–„",keywords:"æ„Ÿå—æ€§ãƒ»å…±æ„Ÿãƒ»èŠ¸è¡“", love:"å…±æ„ŸãŒæœ€é‡è¦ã€‚ç¹Šç´°ãªã‚„ã•ã—ã•ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", career:"ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼/ã‚¢ãƒ¼ãƒˆ/ç™‚æ³•/åŸ·ç­†ã€‚"},
  "å°¾ç«è™":{type:"æ€¥é€Ÿ",keywords:"æƒ…ç†±ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»ç›®ç«‹ã¤", love:"æ‹ã¯ä¸€ç›´ç·šã€‚ãƒ©ã‚¤ãƒãƒ«ã®ã„ã‚‹æ‹ã«ç‡ƒãˆã‚‹ã€‚", career:"ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ/èˆå°/ã‚¹ãƒãƒ¼ãƒ„/èµ·æ¥­ã€‚"},
  "ç®•æ°´è±¹":{type:"æ€¥é€Ÿ",keywords:"ç™ºä¿¡ãƒ»æ‹¡æ•£ãƒ»SNS", love:"è¨€è‘‰ã®ç›¸æ€§ãŒå‘½ã€‚çŸ¥çš„ã§è»½ã‚„ã‹ãªç›¸æ‰‹ã€‚", career:"ãƒ¡ãƒ‡ã‚£ã‚¢/ãƒãƒ¼ã‚±/æ•™è‚²/ITã€‚"},
  "æ–—æœ¨ç¬":{type:"å’Œå–„",keywords:"å®ˆã‚‹ãƒ»åœ°å…ƒãƒ»å …å®Ÿ", love:"å®¶æ—è¦³ã‚’é‡è¦–ã€‚åœ°ã«è¶³ã®ã¤ã„ãŸç›¸æ‰‹ã€‚", career:"ä¸å‹•ç”£/é£Ÿ/åœŸæœ¨/ä¿å®ˆã€‚"},
  "å¥³åœŸè ":{type:"å’Œå–„",keywords:"æ°—é…ã‚Šãƒ»è‚²ã‚€", love:"å°½ãã™æ„›ã€‚å®‰å¿ƒæ„Ÿã¨èª å®Ÿã•é‡è¦–ã€‚", career:"çœ‹è­·/ä¿è‚²/äººäº‹/ãƒãƒƒã‚¯ã‚ªãƒ•ã‚£ã‚¹ã€‚"},
  "è™šæ—¥é¼ ":{type:"å‡¶å„",keywords:"ç©ºå›ã‚Šæ³¨æ„ãƒ»ç„¦ã‚Šç¦ç‰©", love:"ç›¸æ‰‹ã‚’ç†æƒ³åŒ–ã—ã‚„ã™ã„ã€‚ç¾å®Ÿç¢ºèªã‚’ã€‚", career:"è¶³å ´å›ºã‚ãŒå‰ã€‚æ”»ã‚ã¯æ™‚æœŸã‚’è¦‹ã¦ã€‚"},
  "å±æœˆç‡•":{type:"æ€¥é€Ÿ",keywords:"ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ»ç©ºã‚’é£›ã¶", love:"è‡ªç”±ãªè·é›¢æ„ŸãŒâ—ã€‚æŸç¸›NGã€‚", career:"ç‰©æµ/æ—…è¡Œ/ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–/ITã€‚"},
  "å®¤ç«çŒª":{type:"å’Œå–„",keywords:"æ§‹ç¯‰ãƒ»ä¿¡ç”¨", love:"ä¿¡é ¼ãƒ™ãƒ¼ã‚¹ã€‚å …å®Ÿèª å®Ÿãªç›¸æ‰‹ãŒé•·ç¶šãã€‚", career:"å»ºè¨­/é‡‘è/æ³•å‹™/å“è³ªç®¡ç†ã€‚"},
  "å£æ°´è²":{type:"å’Œå–„",keywords:"å®ˆã‚Šãƒ»ä¿å…¨ãƒ»æ´å¯Ÿ", love:"è¦‹æŠœãç›®ãŒé‹­ã„ã€‚èŠ¯ã®å¼·ã•ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", career:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ç ”ç©¶/ç›£æŸ»ã€‚"},
  "å¥æœ¨ç‹¼":{type:"å’Œå–„",keywords:"ä¼ç”»ãƒ»ç·¨é›†ãƒ»çŸ¥è­˜", love:"è¨€èªæ„Ÿè¦šã®åˆã†äººã€‚çŸ¥çš„ã§ç«¯æ­£ã€‚", career:"ç·¨é›†/ä¼ç”»/UX/PMã€‚"},
  "å©é‡‘ç‹—":{type:"å’Œå–„",keywords:"å‡ å¸³é¢ãƒ»è·äºº", love:"èª å®Ÿç¬¬ä¸€ã€‚æ™‚é–“ã‚’å®ˆã‚‹äººã«å¥½æ„Ÿã€‚", career:"è·äºº/æ•´å‚™/åŒ»ç™‚/çµŒç†ã€‚"},
  "èƒƒåœŸé›‰":{type:"å’Œå–„",keywords:"è¡£é£Ÿä½ãƒ»ç”Ÿæ´»å®Ÿå‹™", love:"ç”Ÿæ´»åŠ›é‡è¦–ã€‚å®¶äº‹åŠ›ã‚„é‡‘éŠ­æ„Ÿè¦šâ—", career:"é£²é£Ÿ/å°å£²/ä»‹è­·/ç”Ÿæ´»ã‚µãƒ¼ãƒ“ã‚¹ã€‚"},
  "æ˜´æ—¥éµ ":{type:"æ€¥é€Ÿ",keywords:"ã‚¹ã‚¿ãƒ¼æ€§ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰", love:"æƒ…ç†±ã«æƒ¹ã‹ã‚Œã‚‹ã€‚ç›´çƒå‹è² ã€‚", career:"è¡¨ç¾/å–¶æ¥­/ã‚¹ãƒãƒ¼ãƒ„/èˆå°ã€‚"},
  "ç•¢æœˆçƒ":{type:"å’Œå–„",keywords:"ç©ã¿ä¸Šã’ãƒ»å®‰å®šå¿—å‘", love:"ã¾ã˜ã‚/ç¶™ç¶šåŠ›ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", career:"å…¬å‹™/é‡‘è/ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚"},
  "è§œç«çŒ´":{type:"æ€¥é€Ÿ",keywords:"è¨€è«–ãƒ»æ‰¹è©•ãƒ»æŠ€è¡“", love:"ä¼šè©±ã§å¥½ãã«ãªã‚‹ã€‚é ­ã®è‰¯ã•â—", career:"IT/ç ”ç©¶/æ³•å¾‹/åˆ†æã€‚"},
  "å‚æ°´çŒ¿":{type:"æ€¥é€Ÿ",keywords:"çªç ´ãƒ»æ”¹é©", love:"ç‹¬ç«‹å¿ƒã®å¼·ã„ç›¸æ‰‹ã€‚å…±ã«æŒ‘æˆ¦ã€‚", career:"èµ·æ¥­/æ–°è¦äº‹æ¥­/ã‚³ãƒ³ã‚µãƒ«ã€‚"},
  "äº•æœ¨çŠ´":{type:"å’Œå–„",keywords:"å­¦ã³ãƒ»ä¼çµ±ãƒ»ç²¾ç¥æ€§", love:"ç²¾ç¥æ€§ã®åˆè‡´ã€‚å¸«å¼Ÿ/åŒå¿—å‹ã€‚", career:"æ•™è‚²/å®—æ•™/æ²»ç™‚/ä¼çµ±ç”£æ¥­ã€‚"},
  "é¬¼é‡‘ç¾Š":{type:"å‡¶å„",keywords:"è­¦æˆ’ãƒ»æ…é‡", love:"åˆºæ¿€çš„ãªé–¢ä¿‚ã«è¦æ³¨æ„ã€‚ã‚†ã£ãã‚Šâ—", career:"å®ˆã‚Šã‚’å›ºã‚ã‚‹æ™‚ã€‚æ”¹å–„ã¨å†…çœã€‚"},
  "æŸ³åœŸç":{type:"æ€¥é€Ÿ",keywords:"ã—ãªã‚„ã‹ãƒ»è‡¨æ©Ÿå¿œå¤‰", love:"è‡ªç”±Ã—èª å®Ÿã€‚æŸç¸›å°‘ãªã„é–¢ä¿‚ã€‚", career:"æ¥å®¢/è¦³å…‰/ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã€‚"},
  "æ˜Ÿæ—¥é¦¬":{type:"æ€¥é€Ÿ",keywords:"é å¾ãƒ»ç§»å‹•ãƒ»æµ·å¤–", love:"è·é›¢æ‹æ„›OKã€‚å†’é™ºå¿ƒâ—", career:"è²¿æ˜“/å¤–è³‡/äº¤é€šã€‚"},
  "å¼µæœˆé¹¿":{type:"å’Œå–„",keywords:"é­…ã›ã‚‹ãƒ»ä½™è£•", love:"å™¨ã®å¤§ãã•/å¯›å®¹ã•ã«æƒ¹ã‹ã‚Œã‚‹ã€‚", career:"åºƒå ±/å¸ä¼š/èŠ¸èƒ½/ãƒ›ã‚¹ãƒ”ã‚¿ãƒªãƒ†ã‚£ã€‚"},
  "ç¿¼ç«è›‡":{type:"æ€¥é€Ÿ",keywords:"æˆ¦ç•¥ãƒ»é‹­æ•", love:"é ­è„³æˆ¦ã®æ‹ã€‚ãƒªã‚¹ãƒšã‚¯ãƒˆå‘½ã€‚", career:"æˆ¦ç•¥/åˆ†æ/PM/é‡‘èã€‚"},
  "è»«æ°´èš“":{type:"å’Œå–„",keywords:"ç™’ã‚„ã—ãƒ»å¥‰ä»•ãƒ»æ—…ç«‹ã¡", love:"åŒ…å®¹åŠ›ã«æƒ¹ã‹ã‚Œã‚‹ã€‚åˆ¥ã‚Œã®æµ„åŒ–ã‚‚ã€‚", career:"åŒ»ç™‚/ç¦ç¥‰/æ”¯æ´/ç§»å‹•ã‚µãƒ¼ãƒ“ã‚¹ã€‚"}
};

// æ•°ç§˜ï¼šãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ï¼ˆ1ã€œ9/11/22/33å¯¾å¿œï¼‰
function digitalRootSum(n){
  // ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ä¿è­·
  const s = String(n).split("").reduce((a,b)=>a+Number(b),0);
  if([11,22,33].includes(s)) return s;
  let r = s;
  while(r>9) r = String(r).split("").reduce((a,b)=>a+Number(b),0);
  return r;
}
function lifePathFromDate(y,m,d){
  const total = [...String(y),...String(m),...String(d)].reduce((a,b)=>a+Number(b),0);
  // ãƒã‚¹ã‚¿ãƒ¼ä¿æŒ
  const first = total;
  if([11,22,33].includes(first)) return first;
  return digitalRootSum(total);
}

// æ•°ç§˜ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆè¦ç‚¹ã®ã¿ï¼é•·æ–‡ã¯å¾Œæ®µã§çµ„ã¿ç«‹ã¦ï¼‰
const LP_PROFILE = {
  1:{title:"é–‹æ‹“è€…", traits:"è‡ªç«‹ãƒ»è¡Œå‹•ãƒ»æ±ºæ–­ã€‚å…ˆé ­ã‚’åˆ‡ã‚‹åŠ›ã€‚", love:"ä¸»å°æ¨©ã‚’å–ã‚ŠãŸã„ã€‚å°Šæ•¬ã§ãã‚‹ç›¸æ‰‹ã€‚", career:"èµ·æ¥­/å–¶æ¥­/ãƒªãƒ¼ãƒ€ãƒ¼/æ–°è¦äº‹æ¥­ã€‚"},
  2:{title:"èª¿å’Œè€…", traits:"å”èª¿ãƒ»å…±æ„Ÿãƒ»ã‚µãƒãƒ¼ãƒˆã€‚ç¹‹ãåŠ›ã€‚", love:"å„ªã—ã•/å®‰å¿ƒæ„Ÿã€‚äºŒäººä¸‰è„šã€‚", career:"äººäº‹/ç§˜æ›¸/ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°/é€šè¨³ã€‚"},
  3:{title:"è¡¨ç¾è€…", traits:"æ˜ã‚‹ã•ãƒ»ç™ºæƒ³ãƒ»è¨€èªåŒ–ã€‚", love:"æ¥½ã—ã„ä¼šè©±/ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã€‚", career:"åºƒå ±/ãƒ©ã‚¤ã‚¿ãƒ¼/ãƒ‡ã‚¶ã‚¤ãƒ³/ä¼ç”»ã€‚"},
  4:{title:"å®‰å®šæ§‹ç¯‰", traits:"ä»•çµ„åŒ–ãƒ»ä¿¡é ¼ãƒ»ç¶™ç¶šã€‚", love:"å …å®Ÿ/èª å®Ÿã€‚å®¶åº­å¿—å‘ã€‚", career:"çµŒç†/å“è³ª/å…¬å‹™/ä¸å‹•ç”£ã€‚"},
  5:{title:"å¤‰åŒ–æ¨é€²", traits:"è‡ªç”±ãƒ»æ—…ãƒ»å¤‰é©ã€‚", love:"åˆºæ¿€ã¨è‡ªç”±ã€‚æŸç¸›NGã€‚", career:"å–¶æ¥­/æ—…è¡Œ/ãƒ™ãƒ³ãƒãƒ£ãƒ¼/ITã€‚"},
  6:{title:"è²¬ä»»ã¨æ„›", traits:"é¢å€’è¦‹ãƒ»ç¾æ„è­˜ãƒ»èª¿æ•´ã€‚", love:"æ€ã„ã‚„ã‚Š/å®¶æ—è¦³ã€‚", career:"æ•™è‚²/åŒ»ç™‚/ãƒ‡ã‚¶ã‚¤ãƒ³/æ¥å®¢ã€‚"},
  7:{title:"æ¢ç©¶è€…", traits:"åˆ†æãƒ»ç²¾ç¥æ€§ãƒ»å°‚é–€æ€§ã€‚", love:"çŸ¥æ€§/è·é›¢æ„Ÿã®å°Šé‡ã€‚", career:"ç ”ç©¶/IT/æ³•å¾‹/å è¡“ã€‚"},
  8:{title:"å®Ÿç¾åŠ›", traits:"æ¨©é™ãƒ»æˆæœãƒ»ãƒãƒãƒ¼ã€‚", love:"ä»•äº‹ã«ç†è§£ã®ã‚ã‚‹ç›¸æ‰‹ã€‚", career:"çµŒå–¶/é‡‘è/å–¶æ¥­çµ±æ‹¬ã€‚"},
  9:{title:"å¥‰ä»•ã¨å…±æ„Ÿ", traits:"æ™®éæ€§ãƒ»å…±æ„Ÿãƒ»èŠ¸è¡“ã€‚", love:"å„ªã—ã•/ä¸–ç•Œè¦³ã®åˆè‡´ã€‚", career:"ç¦ç¥‰/èŠ¸è¡“/NPO/æ•™è‚²ã€‚"},
  11:{title:"éœŠæ„Ÿã¨å•“ç™º", traits:"ç›´è¦³ãƒ»ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ã€‚", love:"ç²¾ç¥æ€§/æ³¢é•·ã®ä¸€è‡´ã€‚", career:"ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«/è¡¨ç¾/æ•™è‚²ã€‚"},
  22:{title:"å¤§å™¨æ§‹ç¯‰", traits:"ç¤¾ä¼šçš„ãªå¤§äº‹æ¥­ãƒ»ç¾å®ŸåŒ–ã€‚", love:"ç›®æ¨™ã‚’å…±æœ‰ã§ãã‚‹ç›¸æ‰‹ã€‚", career:"å»ºè¨­/å¤§è¦æ¨¡PM/çµŒå–¶ã€‚"},
  33:{title:"ç„¡æ¡ä»¶ã®æ„›", traits:"ãƒ’ãƒ¼ãƒªãƒ³ã‚°ãƒ»å¥‰ä»•ãƒ»èŠ¸è¡“çš„è¡¨ç¾ã€‚", love:"åŒ…å®¹åŠ›/å…±æ„Ÿã€‚", career:"ç™‚æ³•/èŠ¸è¡“/å¥‰ä»•é ˜åŸŸã€‚"}
};

// å€‹äººå¹´ãƒ»å€‹äººæœˆï¼ˆæ•°ç§˜ï¼‰
function personalYearNum(birthY,birthM,birthD,forYear){
  const sum = digitalRootSum(digitalRootSum(birthM+birthD)+digitalRootSum(forYear));
  return sum;
}
function personalMonthNum(pYear, month){
  return digitalRootSum(pYear + month);
}

/* ---------- 27å®¿åˆ¤å®š ---------- */
function shukuFromDate(dateUTC){
  const lon = moonEclipticLongitude(dateUTC); // 0..360
  const idx = Math.floor(lon / (360/27)); // 0..26
  return {name: SHUKU[idx], deg: lon};
}

/* ---------- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆæ•°ç§˜ï¼‹å®¿æ›œè£œæ­£ï¼‰ ---------- */
function monthTags(pMonth, shukuName){
  // æ•°ç§˜ï¼šå€‹äººæœˆâ†’ãƒ†ãƒ¼ãƒ
  // 1:ã‚¹ã‚¿ãƒ¼ãƒˆ 2:é–¢ä¿‚ 3:è¡¨ç¾ 4:åŸºç›¤ 5:å¤‰åŒ– 6:æ„›/å®¶åº­ 7:å†…çœ 8:æˆæœ/ãŠé‡‘ 9:æ‰‹æ”¾ã—
  const tags=[];
  const push=(label,cls)=>tags.push({label,cls});
  const good="t-good", warn="t-warn", bad="t-bad";

  // åŸºæœ¬ã‚¿ã‚°ï¼ˆæ•°ç§˜ï¼‰
  const mapBase={
    1:[{k:"å‡ºä¼šã„â—",c:good},{k:"è»¢è·ã®æº–å‚™â—¯",c:warn}],
    2:[{k:"æ‹æ„›â—",c:good},{k:"çµå©šã®è©±ã‚’é€²ã‚ã‚‹â—¯",c:good}],
    3:[{k:"å‡ºä¼šã„â—¯",c:good}],
    4:[{k:"å¼•è¶Šã—ä¸‹è¦‹â—¯",c:warn},{k:"å¥‘ç´„ã¯æ…é‡",c:warn}],
    5:[{k:"è»¢è·/å¼•è¶Šã—â—",c:good},{k:"å‹¢ã„ã§ã®çµå©šæ³¨æ„",c:warn}],
    6:[{k:"çµå©šâ—",c:good},{k:"å®¶æ—ãƒ†ãƒ¼ãƒæ¿ƒã„",c:warn}],
    7:[{k:"é™é¤Š/è¦‹ç›´ã—",c:warn}],
    8:[{k:"æ˜‡é€²/äº¤æ¸‰â—",c:good},{k:"å©šç´„ã‚’å›ºã‚ã‚‹â—¯",c:good}],
    9:[{k:"æ‰‹æ”¾ã—/å®Œäº†",c:warn},{k:"å¾©ç¸è©±ã¯è¦ç†Ÿè€ƒ",c:bad}]
  };
  (mapBase[pMonth]||[]).forEach(x=>push(x.k, x.c));

  // å®¿æ›œè£œæ­£ï¼ˆå®‰ãƒ»æ „ãƒ»æˆâ†’è¿½ã„é¢¨ï¼è™šãƒ»é¬¼â†’æ…é‡ï¼‰
  const goodShuku = ["è§’æœ¨è›Ÿ","æˆ¿æ—¥å…","å°¾ç«è™","ç®•æ°´è±¹","æ˜´æ—¥éµ ","å¼µæœˆé¹¿","ç¿¼ç«è›‡","å¥æœ¨ç‹¼","å®¤ç«çŒª","æ˜Ÿæ—¥é¦¬","è»«æ°´èš“"];
  const warnShuku = ["è™šæ—¥é¼ ","é¬¼é‡‘ç¾Š"];
  if(goodShuku.includes(shukuName)) push("å®¿æ›œï¼šè¿½ã„é¢¨", good);
  if(warnShuku.includes(shukuName)) push("å®¿æ›œï¼šæ…é‡", warn);

  return tags;
}

/* ---------- é•·æ–‡ç”Ÿæˆ ---------- */
function buildMeiText(lp, shukuName){
  const L = LP_PROFILE[lp];
  const S = SHUKU_PROFILE[shukuName]||{type:"",keywords:"",love:"",career:""};
  return `
ã€æ•°ç§˜ãƒ»ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ ${lp}ï½œ${L.title}ã€‘  
ã‚ãªãŸã®æ ¹æœ¬è³‡è³ªã¯ã€Œ${L.traits}ã€ã€‚  
çŸ­æœŸçš„ãªå°æ‰‹å…ˆã‚ˆã‚Šã‚‚ã€${L.career}ã®ã‚ˆã†ã«<strong>æŒã¡å‘³ã‚’æ´»ã‹ã™å ´</strong>ã§å®ŸåŠ›ãŒä¼¸ã³ã¾ã™ã€‚  
æ‹ã¯ã€Œ${L.love}ã€ãŒéµã€‚è‡ªåˆ†ã®èŠ¯ã‚’å°Šé‡ã—ã¦ãã‚Œã‚‹ç›¸æ‰‹ã¨ç›¸ä¹—åŠ¹æœãŒç”Ÿã¾ã‚Œã¾ã™ã€‚

ã€å®¿æ›œï¼š${shukuName}ï¼ˆæ€§è³ªï¼š${S.type}ï¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š${S.keywords}ï¼‰ã€‘  
æƒ…ç·’ãƒ»ç›´æ„Ÿã®ä½¿ã„æ–¹ã¯å®¿æ›œãŒå¸ã‚Šã¾ã™ã€‚ã‚ãªãŸã¯ã€Œ${S.keywords}ã€ã‚’ãƒ†ãƒ¼ãƒã«é­‚ãŒæˆç†Ÿã—ã¦ã„ãã¾ã™ã€‚  
æ‹æ„›ã¯ã€Œ${S.love}ã€ã€‚ä»•äº‹ã¯ã€Œ${S.career}ã€ã«é©æ€§ã€‚  

â–¶ ç·åˆã™ã‚‹ã¨ã€<strong>${L.title}Ã—${S.type}</strong>ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã€‚  
ã€Œ${S.keywords}ã€ã®èˆå°ã§ã€${L.career}ã®ä¸­ã§ã‚‚<strong>è‡ªåˆ†ã‚‰ã—ã„ã‚„ã‚Šæ–¹</strong>ã‚’ç¯‰ãã»ã©æˆåŠŸåº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚`;
}

function buildUnText(birth, dateUTC){
  const now = new Date();
  const by = birth.getUTCFullYear(), bm=birth.getUTCMonth()+1, bd=birth.getUTCDate();
  const thisYear = now.getFullYear();
  const py = personalYearNum(by,bm,bd,thisYear);
  const next = personalYearNum(by,bm,bd,thisYear+1);
  const nn = personalYearNum(by,bm,bd,thisYear+2);

  const note = {
    1:"å§‹å‹•ã®å¹´ã€‚ååˆºã‚’é…ã‚Šç›´ã™ï¼æ–°ç¿’æ…£ã®å®šç€ã€‚",
    2:"äººé–“é–¢ä¿‚ã®å¹´ã€‚èª°ã¨çµ„ã‚€ã‹ï¼ç›¸è«‡ç›¸æ‰‹ã‚’å›ºã‚ã‚‹ã€‚",
    3:"ç™ºä¿¡ã®å¹´ã€‚SNS/åºƒå ±/æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¨€èªåŒ–ã€‚",
    4:"åŸºç›¤åŒ–ã®å¹´ã€‚ä»•çµ„ã¿åŒ–/è³‡é‡‘ç¹°ã‚Š/åœ¨åº«ã¨æ•°å­—ã€‚",
    5:"è»¢æ©Ÿã®å¹´ã€‚æ‹ ç‚¹ã‚„ä»•äº‹ã®â€œåˆ·æ–°â€ã€‚",
    6:"æ„›ã¨è²¬ä»»ã®å¹´ã€‚çµå©š/å®¶æ—/ãƒ–ãƒ©ãƒ³ãƒ‰ç£¨ãã€‚",
    7:"å†…è¦³ã®å¹´ã€‚å­¦ã³/æ•´ãˆã‚‹/ä½“èª¿ã‚±ã‚¢ã‚’æœ€å„ªå…ˆã€‚",
    8:"æˆæœã®å¹´ã€‚å€¤ä¸Šã’/æ˜‡é€²/æŠ•è³‡å›åã€‚",
    9:"å®Œäº†ã®å¹´ã€‚æ‰‹æ”¾ã—/æ•´ç†/æ¬¡ç« ã¸å—ã‘æ¸¡ã—ã€‚"
  };

  return `
ã€å€‹äººå¹´ï¼ˆæ•°ç§˜ã‚µã‚¤ã‚¯ãƒ«ï¼‰ã€‘  
${thisYear}å¹´ï¼š<strong>${py}</strong> â†’ ${note[py]}  
${thisYear+1}å¹´ï¼š<strong>${next}</strong> â†’ ${note[next]}  
${thisYear+2}å¹´ï¼š<strong>${nn}</strong> â†’ ${note[nn]}  

ã€é‹ã®æ‰±ã„æ–¹ï¼ˆå®Ÿå‹™ï¼‰ã€‘  
ãƒ»<strong>å‹•ãæœˆï¼š1/5/8</strong>ï¼ˆæ–°è¦ãƒ»åˆ·æ–°ãƒ»äº¤æ¸‰ï¼‰ã€‚  
ãƒ»<strong>è‚²ã¦ã‚‹æœˆï¼š2/3/6</strong>ï¼ˆé–¢ä¿‚/ç™ºä¿¡/ãƒ–ãƒ©ãƒ³ãƒ‰ï¼‰ã€‚  
ãƒ»<strong>æ•´ãˆã‚‹æœˆï¼š4/7/9</strong>ï¼ˆä»•çµ„åŒ–/å­¦ã³/æ‰‹æ”¾ã—ï¼‰ã€‚  
æ•°å­—ã®â€œå­£ç¯€â€ã«åˆã‚ã›ã€äºˆå®šè¡¨ã‚’å…ˆã«åŸ‹ã‚ã‚‹ã¨ãƒ–ãƒ¬ã¾ã›ã‚“ã€‚`;
}

function buildBokuText(pMonth){
  const msg = {
    1:"ä»Šã¯â€œã¯ã˜ã‚ã‚‹å‹‡æ°—â€ãŒé‹ã‚’å‘¼ã¶ã€‚ã¾ãšå°ã•ãç€æ‰‹ã€‚",
    2:"å‘¨ã‚Šã®å£°ã«å®ãŒã‚ã‚‹ã€‚2äººãƒãƒ¼ãƒ ã§å‹•ãã¨é€Ÿã„ã€‚",
    3:"è¨€è‘‰ã¨è¡¨æƒ…ãŒéµã€‚ç™ºä¿¡ãƒ»å–¶æ¥­ãƒ»SNSã‚’å¢—ã‚„ã™ã€‚",
    4:"åœŸå°ã®æ•´å‚™ã€‚ãƒãƒ‹ãƒ¥ã‚¢ãƒ«/ãƒ†ãƒ³ãƒ—ãƒ¬ä½œæˆã§æˆæœUPã€‚",
    5:"å¤‰ãˆã‚‹å‹‡æ°—ã€‚å ´æ‰€ãƒ»æ–¹æ³•ãƒ»ä¾¡æ ¼ã®è¦‹ç›´ã—å‰ã€‚",
    6:"å“è³ªã¨ãŠã‚‚ã¦ãªã—ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼åé›†ï¼†æ”¹å–„ã€‚",
    7:"ä¸€æ‹ç½®ãã€‚å­¦ã³/åˆ†æ/ç¡çœ ã§é‹­ã•ã‚’å–ã‚Šæˆ»ã™ã€‚",
    8:"æ”»ã‚ã®äº¤æ¸‰ã€‚å€¤ä¸Šã’ãƒ»å½¹å‰²æ‹¡å¼µã«ãƒ„ã‚­ã€‚",
    9:"å®Œäº†ã¨æµ„åŒ–ã€‚ä½™ç™½ã‚’ä½œã‚Œã°æ¬¡ã®ç¸ãŒå…¥ã‚‹ã€‚"
  };
  return msg[pMonth] || "ä»Šæœˆã®ãƒ†ãƒ¼ãƒã‚’é™ã‹ã«è¦³å¯Ÿã—ã¦ã¿ã‚ˆã†ã€‚";
}

function buildCareerLoveLong(lp, shukuName, gender){
  const L = LP_PROFILE[lp]; const S = SHUKU_PROFILE[shukuName]||{};
  const gWord = gender==="female" ? "ç”·æ€§" : "ç›¸æ‰‹";
  const loveType = {
    1:`å°Šæ•¬ã§ãã‚‹${gWord}ã€‚è‡ªç«‹/ç›®æ¨™ã‚’æŒã¤äººã€‚ç«¶ã„åˆã„ã‚ˆã‚Šâ€œä¸¦èµ°â€ãŒé•·ç¶šãã€‚`,
    2:`å®‰å¿ƒã¨å„ªã—ã•ã€‚èãä¸Šæ‰‹ã€‚é™ã‹ãªãƒªãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ—ã«æƒ¹ã‹ã‚Œã‚„ã™ã„ã€‚`,
    3:`ä¼šè©±ã¨ãƒ¦ãƒ¼ãƒ¢ã‚¢ã€‚ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã€‚ã‚¤ãƒ™ãƒ³ãƒˆ/æ—…ã§è·é›¢ãŒç¸®ã¾ã‚‹ã€‚`,
    4:`å …å®Ÿã§èª å®Ÿã€‚æ™‚é–“/ãŠé‡‘ã«å¼·ã„äººã€‚ç”Ÿæ´»åŠ›ã®é«˜ã•ã€‚`,
    5:`è‡ªç”±ã¨åˆºæ¿€ã€‚å¤šè¶£å‘³/å›½éš›æ„Ÿè¦šã€‚æŸç¸›ã®å°‘ãªã„é–¢ä¿‚ã€‚`,
    6:`æ€ã„ã‚„ã‚Š/æ¸…æ½”æ„Ÿ/å®¶æ—è¦³ã€‚ç¾æ„è­˜ã®è¿‘ã•ãŒéµã€‚`,
    7:`çŸ¥æ€§/å°‚é–€æ€§/ç²¾ç¥æ€§ã€‚é©åº¦ãªè·é›¢ã‚’å°Šé‡ã™ã‚‹äººã€‚`,
    8:`é‡å¿ƒ/å®Ÿè¡ŒåŠ›/åŒ…å®¹åŠ›ã€‚ä»•äº‹ç†è§£ã¨Win-Winæ„Ÿã€‚`,
    9:`ä¸–ç•Œè¦³/å„ªã—ã•/å¥‰ä»•å¿ƒã€‚ç¤¾ä¼šæ€§ã‚„ã‚¢ãƒ¼ãƒˆæ„Ÿè¦šã®ä¸€è‡´ã€‚`,
    11:`æ³¢é•·/ç›´è¦³/éœŠæ€§ã€‚ç¹Šç´°ã•ã«é…æ…®ã§ãã‚‹äººã€‚`,
    22:`å¤§å¿—/ç¾å®ŸåŠ›ã€‚å…±ã«â€œã§ã‹ã„è¨ˆç”»â€ã‚’å‹•ã‹ã›ã‚‹äººã€‚`,
    33:`ç„¡æ¡ä»¶ã®æ„›ã€‚ã‚±ã‚¢ã¨å‰µé€ æ€§ã€‚å–„æ„ã‚’å¾ªç’°ã§ãã‚‹äººã€‚`
  }[lp];

  const careerExtra = (S.career?`å®¿æ›œã‹ã‚‰è¦‹ã‚‹èˆå°ã¯ã€Œ${S.career}ã€ã€‚`:"");
  return `
ã€è·æ¥­é©æ€§ï¼ˆé•·æ–‡ï¼‰ã€‘  
æ•°ç§˜${lp}ã¯ã€Œ${L.title}ã€ã€‚${L.traits}ã€‚  
${careerExtra}
ã•ã‚‰ã«ã€ã‚ãªãŸã¯ã€Œ${S.keywords||"çŠ¶æ³ã‚’è¦‹æ¥µã‚ã‚‹"}ã€ã‚’è»¸ã«æˆæœã‚’å‡ºã™ã‚¿ã‚¤ãƒ—ã€‚  
<strong>ãŠã™ã™ã‚æˆ¦ç•¥ï¼š</strong>
1) è‡ªåˆ†ã®â€œå‹â€ã‚’æŒã¤ï¼ˆæ‰‹é †ãƒ»å°æœ¬ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬åŒ–ï¼‰ã€‚  
2) æ¯æœˆã®æ•°ç§˜ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã€<em>æ”»ã‚ã‚‹æœˆï¼ˆ1/5/8ï¼‰</em>ã¨<em>æ•´ãˆã‚‹æœˆï¼ˆ4/7/9ï¼‰</em>ã‚’åˆ†ã‘ã‚‹ã€‚  
3) å£ã‚³ãƒŸè¨­è¨ˆï¼šãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼ã®è¨€èªåŒ–ï¼ãŠå®¢æ§˜ã®å£°ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚‹ã€‚  

ã€æƒ¹ã‹ã‚Œã‚„ã™ã„${gWord}ã®ã‚¿ã‚¤ãƒ—ã€‘  
${loveType}  
å®¿æ›œã€Œ${shukuName}ã€ã®æƒ…ç·’å‚¾å‘ã‹ã‚‰ã€<em>${(SHUKU_PROFILE[shukuName]||{}).love||"èª å®Ÿã•ã¨ç›¸äº’æˆé•·"}</em>ãŒé•·æœŸå®‰å®šã®éµã€‚  
â€œå°Šæ•¬ï¼‹å®‰å¿ƒâ€ã‚’ä¸¡ç«‹ã™ã‚‹é–¢ä¿‚ä½œã‚Šã§ã€æ‹ã‚‚ä»•äº‹ã‚‚è‡ªç„¶ã«ä¼¸ã³ã¾ã™ã€‚`;
}

/* ---------- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---------- */
function renderCalendar(birthUTC, by,bm,bd, shukuName){
  const cont = document.getElementById("calendar");
  cont.innerHTML="";
  const now = new Date();
  const start = new Date(Date.UTC(now.getFullYear(), now.getMonth(), 1));
  for(let i=0;i<36;i++){
    const d = new Date(Date.UTC(start.getUTCFullYear(), start.getUTCMonth()+i, 1));
    const py = personalYearNum(by,bm,bd,d.getUTCFullYear());
    const pm = personalMonthNum(py, d.getUTCMonth()+1);
    // æœˆåˆã®å®¿ã§è£œæ­£ï¼ˆå³å¯†ã«æ¯æ—¥å¤‰ã‚ã‚‹ãŒç°¡æ˜“é©ç”¨ï¼‰
    const tags = monthTags(pm, shukuName);
    const y = d.getUTCFullYear();
    const m = d.getUTCMonth()+1;
    const box = document.createElement("div");
    box.className="mon";
    box.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
        <strong>${y}å¹´${m}æœˆ</strong>
        <span class="pill">å€‹äººæœˆ ${pm}</span>
      </div>
      <div style="margin-top:6px">` +
      tags.map(t=>`<span class="tag ${t.c}">${t.label}</span>`).join("") +
      `</div>
      <div class="small muted" style="margin-top:6px">æ‹æ„›â—:2/6ï½œçµå©šâ—:6/8ï½œå‡ºä¼šã„â—:1/3/5ï½œå¼•è¶Šã—â—:5ï½œè»¢è·â—:1/5/8ï¼ˆå®¿æ›œã§åŠ ç‚¹/æ¸›ç‚¹ï¼‰</div>`;
    cont.appendChild(box);
  }
}

/* ---------- ãƒ¡ã‚¤ãƒ³å‡¦ç† ---------- */
document.getElementById("run").addEventListener("click", ()=>{
  const birth = document.getElementById("birth").value;
  if(!birth){ alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  const time = document.getElementById("btime").value || "";
  const tzSel = document.getElementById("tz").value;
  const tz = tzSel==="" ? null : Number(tzSel);
  const gender = document.getElementById("gender").value||"";

  const {dateUTC,tzHours} = toDateWithTZ(birth, time, tz);
  const jd = julianDay(dateUTC);

  const y = dateUTC.getUTCFullYear(), m = dateUTC.getUTCMonth()+1, d = dateUTC.getUTCDate();
  const lp = lifePathFromDate(y,m,d);
  const shuku = shukuFromDate(dateUTC);

  // å€‹äººå¹´ï¼ˆä»Šå¹´ï¼‰
  const now = new Date();
  const py = personalYearNum(y,m,d, now.getFullYear());

  // å‡ºåŠ›
  document.getElementById("lifePath").textContent = lp;
  document.getElementById("shuku").textContent = `${shuku.name}`;
  document.getElementById("pyear").textContent = py;

  document.getElementById("sectionMei").innerHTML = buildMeiText(lp, shuku.name);
  document.getElementById("sectionUn").innerHTML  = buildUnText(new Date(Date.UTC(y,m-1,d)), dateUTC);

  const pMonthNow = personalMonthNum(py, now.getMonth()+1);
  document.getElementById("sectionBoku").innerHTML = buildBokuText(pMonthNow);

  document.getElementById("sectionCareerLove").innerHTML = buildCareerLoveLong(lp, shuku.name, gender);

  renderCalendar(dateUTC, y,m,d, shuku.name);
});
</script>
</body>
</html>
