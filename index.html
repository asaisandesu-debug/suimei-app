<!doctype html>
<html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>å››æŸ±æ¨å‘½ï¼‹æ•°ç§˜è¡“ Proï¼ˆç·åˆãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼†æ™‚æœŸåˆ¤å®šï¼š3å¹´æ‹¡å¼µï¼‰</title>
<style>
:root{--bg:#0b0c10;--card:#151821;--ink:#f5f7ff;--sub:#b6c0d6;--acc:#7ee1b5;--line:#23283a;--good:#66bb6a;--warn:#ffb74d;--bad:#ef5350}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",Roboto,Arial;line-height:1.6}
header{padding:14px 14px 8px;background:linear-gradient(180deg,rgba(0,0,0,.55),transparent)}
h1{margin:0;font-size:18px}small{color:var(--sub)}main{padding:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:10px 0}
.row{display:flex;gap:8px;flex-wrap:wrap}.col{flex:1 1 160px;min-width:150px}
label{display:block;font-size:12px;color:var(--sub);margin:4px 0 6px}
input,select,button{font-size:16px}input,select{width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);background:#0e111a;color:#f5f7ff}
.btn{width:100%;padding:12px;border:none;border-radius:12px;font-weight:700;background:var(--acc);color:#0a0a0a}
.kv{display:flex;gap:8px;flex-wrap:wrap}.chip{background:#0e111a;border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:13px}
.note{font-size:12px;color:#bfc9e6}.small{font-size:12px;color:#9fb0d6}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;border-bottom:1px solid var(--line);vertical-align:top}th{white-space:nowrap;color:#cfe0ff;text-align:left}
.bars{display:flex;gap:8px;align-items:flex-end;height:150px;border-bottom:1px dashed var(--line);padding:6px 2px}
.bar{flex:1;min-width:40px;border-radius:8px 8px 0 0;background:linear-gradient(180deg,#67e8f9,#22d3ee)}
.badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:12px;margin-right:6px}
.err{display:none;background:#331a1a;color:#ffc9c9;border:1px solid #5b2a2a;padding:8px;border-radius:8px;margin-top:6px;font-size:13px}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:4px 8px;font-size:12px;margin:2px;color:#e0f2f1}
.hr{height:1px;background:var(--line);margin:8px 0}
.good{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
.grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
@media(max-width:560px){.grid2{grid-template-columns:1fr}}
.kcell{border:1px solid var(--line);border-radius:10px;padding:8px}
.kcal{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.km{border:1px solid var(--line);border-radius:10px;padding:8px;text-align:center}
.km b{display:block;margin-bottom:4px}
.hitBoth{border-color:#7ee1b5;background:rgba(126,225,181,.12)}
.hitNum{border-color:#4fc3f7;background:rgba(79,195,247,.08)}
.hitSi{border-color:#ffb74d;background:rgba(255,183,77,.10)}
.marry{outline:2px solid #ffd166; box-shadow:0 0 0 3px rgba(255,209,102,.18) inset}
</style></head>
<body>
<header>
  <h1>å››æŸ±æ¨å‘½ï¼‹æ•°ç§˜è¡“ Pro</h1>
  <small>æ€§æ ¼ãƒ»æ‹æ„›è¦³ãƒ»ä»•äº‹ã®å‘ããƒ»é•·æ‰€/çŸ­æ‰€ãƒ»æ™‚æœŸï¼ˆçµå©š/å‡ºä¼šã„/è»¢è·/ç‹¬ç«‹ï¼‰ã‚’è‡ªå‹•è¡¨ç¤ºï½œ3å¹´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</small>
</header>

<main>
  <!-- å…¥åŠ› -->
  <div class="card">
    <div class="row">
      <div class="col"><label>å¹´(è¥¿æš¦)</label><input id="y" type="number" value="1990"></div>
      <div class="col"><label>æœˆ</label><input id="m" type="number" min="1" max="12" value="1"></div>
      <div class="col"><label>æ—¥</label><input id="d" type="number" min="1" max="31" value="1"></div>
      <div class="col"><label>å‡ºç”Ÿæ™‚åˆ»ï¼ˆ24h, ä¾‹ 12:00ï¼‰</label><input id="hm" value="12:00"></div>
    </div>
    <div class="row">
      <div class="col"><label>è”µå¹²ã‚’äº”è¡Œã«å«ã‚ã‚‹</label><select id="zOpt"><option value="on">å«ã‚ã‚‹</option><option value="off">å«ã‚ãªã„</option></select></div>
      <div class="col"><label>è”µå¹²ã‚¦ã‚§ã‚¤ãƒˆ</label><select id="zW"><option value="eq">ç­‰åˆ†</option><option value="pri">ä¸»0.6/æ¬¡0.25/æœ«0.15</option></select></div>
      <div class="col"><label>æœˆæŸ±ã®åˆ¤å®š</label><select id="setu"><option value="const">é«˜ç²¾åº¦ï¼šå®šæ°—æ³•</option><option value="mean">ç°¡æ˜“ï¼šå¹³å‡ç¯€å…¥ã‚Š</option></select></div>
      <div class="col"><label>ã€€</label><button class="btn" id="run">é‘‘å®šã™ã‚‹</button></div>
    </div>
    <div id="err" class="err">æ—¥ä»˜/æ™‚åˆ»ã‚’è¦‹ç›´ã—ã¦ã­</div>
  </div>

  <!-- å‘½å¼ -->
  <div class="card">
    <h3>â—† å‘½å¼ï¼ˆå››æŸ±ï¼‰ï¼‹ã‚„ã•ã—ã„èª­ã¿æ–¹</h3>
    <div class="kv" id="ms"></div>
    <div id="tbl" style="margin-top:8px"></div>
  </div>

  <!-- äº”è¡Œ -->
  <div class="card">
    <h3>â—† äº”è¡Œãƒãƒ©ãƒ³ã‚¹ï¼ˆæœ¨ç«åœŸé‡‘æ°´ï¼‰</h3>
    <div class="note">æ£’ï¼â€œææ–™é…åˆâ€ã€‚å¤šã„â†’ãã®å¼·ã¿ã‚’ä½¿ã†ï¼å°‘ãªã„â†’ç¿’æ…£ã§å°‘ã—è¶³ã™ã€‚</div>
    <div id="bars" class="bars"></div>
    <div id="fftags" style="margin-top:6px"></div>
    <div id="fiveExplain" style="margin-top:8px"></div>
  </div>

  <!-- ç·åˆãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼‰ -->
  <div class="card">
    <h3>â—† ç·åˆãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼‰</h3>
    <div class="grid2">
      <div class="kcell"><b>æ€§æ ¼ãƒ»æ‰èƒ½ãƒ»äººé–“é–¢ä¿‚ã®å‚¾å‘</b><div id="traits"></div></div>
      <div class="kcell"><b>æ‹æ„›è¦³ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼‰</b><div id="loveView"></div></div>
      <div class="kcell"><b>ãŠã™ã™ã‚ã®ãƒ“ã‚¸ãƒã‚¹ï¼åƒãæ–¹</b><div id="business"></div></div>
      <div class="kcell"><b>é•·æ‰€ãƒ»çŸ­æ‰€ï¼ˆä½¿ã„æ–¹ã®ã‚³ãƒ„ï¼‰</b><div id="strengths"></div></div>
    </div>
    <div class="hr"></div>
    <div class="kcell"><b>æ·±æ˜ã‚Šãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ†ãƒ¼ãƒï¼†åˆè¨€è‘‰ï¼‰</b><div id="deepRead" class="note" style="margin-top:4px"></div></div>
  </div>

  <!-- ç›¸æ€§ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼šæ‹æ„›ï¼å‹æƒ…ï¼ãƒ“ã‚¸ãƒã‚¹ï¼‰ -->
  <div class="card">
    <h3>â—† ç›¸æ€§ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼šæ‹æ„›ï¼å‹æƒ…ï¼ãƒ“ã‚¸ãƒã‚¹ï¼‰</h3>
    <div class="row">
      <div class="col"><label>ç›¸æ‰‹ã®å¹´</label><input id="py2" type="number" value="1995"></div>
      <div class="col"><label>ç›¸æ‰‹ã®æœˆ</label><input id="pm2" type="number" min="1" max="12" value="8"></div>
      <div class="col"><label>ç›¸æ‰‹ã®æ—¥</label><input id="pd2" type="number" min="1" max="31" value="15"></div>
      <div class="col"><label>ç›¸æ‰‹ã®å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label><input id="phm2" placeholder="ä¾‹ 07:20"></div>
      <div class="col"><label>ã€€</label><button class="btn" id="compatBtn">ç›¸æ€§ã‚’è¨ºæ–­</button></div>
    </div>
    <div id="compatOut" style="margin-top:6px"></div>
  </div>

  <!-- æ™‚æœŸåˆ¤å®šï¼ˆå››æŸ±ï¼‹æ•°ç§˜ã®WåŸºæº–ï¼‰ -->
  <div class="card">
    <h3>â—† æ™‚æœŸã®ã‚µã‚¤ãƒ³ï¼ˆã“ã‚Œã‹ã‚‰3å¹´ï¼‰</h3>
    <div class="note">è‰²ï¼š<span class="hitBoth">å››æŸ±ï¼‹æ•°ç§˜ã®ä¸¡æ–¹ã§â—</span>ï¼<span class="hitNum">æ•°ç§˜ã§â—</span>ï¼<span class="hitSi">å››æŸ±ã§â—</span>ã€€ğŸ’ï¼çµå©šã«ç‰¹ã«è‰¯ã„æœˆ</div>
    <div id="timing" class="kcal" style="margin-top:6px"></div>
    <div class="small" id="timingLegend"></div>
    <div class="hr"></div>
    <div class="small" id="marryList"></div>
  </div>
</main>

<script>
// ===== å¹²æ”¯ãƒ»äº”è¡Œ åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ =====
var S=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"],
    SE={"ç”²":"æœ¨","ä¹™":"æœ¨","ä¸™":"ç«","ä¸":"ç«","æˆŠ":"åœŸ","å·±":"åœŸ","åºš":"é‡‘","è¾›":"é‡‘","å£¬":"æ°´","ç™¸":"æ°´"},
    SY={"ç”²":"é™½","ä¹™":"é™°","ä¸™":"é™½","ä¸":"é™°","æˆŠ":"é™½","å·±":"é™°","åºš":"é™½","è¾›":"é™°","å£¬":"é™½","ç™¸":"é™°"};
var B=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"],
    MB=["å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥","å­","ä¸‘"];
var ZM={"å­":["å£¬"],"ä¸‘":["å·±","ç™¸","è¾›"],"å¯…":["ç”²","ä¸™","æˆŠ"],"å¯":["ä¹™"],"è¾°":["æˆŠ","ä¹™","ç™¸"],"å·³":["ä¸™","æˆŠ","åºš"],"åˆ":["ä¸","å·±"],"æœª":["å·±","ä¸","ä¹™"],"ç”³":["åºš","å£¬","æˆŠ"],"é…‰":["è¾›"],"æˆŒ":["æˆŠ","è¾›","ä¸"],"äº¥":["å£¬","ç”²"]};
var E=["æœ¨","ç«","åœŸ","é‡‘","æ°´"],
    GEN={"æœ¨":"ç«","ç«":"åœŸ","åœŸ":"é‡‘","é‡‘":"æ°´","æ°´":"æœ¨"},
    CTL={"æœ¨":"åœŸ","åœŸ":"æ°´","æ°´":"ç«","ç«":"é‡‘","é‡‘":"æœ¨"};
var HEX=[["å­","ä¸‘"],["å¯…","äº¥"],["å¯","æˆŒ"],["è¾°","é…‰"],["å·³","ç”³"],["åˆ","æœª"]];
var CHONG=[["å­","åˆ"],["ä¸‘","æœª"],["å¯…","ç”³"],["å¯","é…‰"],["è¾°","æˆŒ"],["å·³","äº¥"]];
var BR_E={"å­":"æ°´","ä¸‘":"åœŸ","å¯…":"æœ¨","å¯":"æœ¨","è¾°":"åœŸ","å·³":"ç«","åˆ":"ç«","æœª":"åœŸ","ç”³":"é‡‘","é…‰":"é‡‘","æˆŒ":"åœŸ","äº¥":"æ°´"};
var PEACH_BY_DAY={"å¯…":"å¯","åˆ":"å¯","æˆŒ":"å¯","ç”³":"é…‰","å­":"é…‰","è¾°":"é…‰","äº¥":"å­","å¯":"å­","æœª":"å­","å·³":"åˆ","é…‰":"åˆ","ä¸‘":"åˆ"};

// ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæ—¥ä»˜â†’å¹²æ”¯ï¼‰ =====
function parseHM(s){if(!s)return[12,0];var m=/^(\d{1,2}):(\d{2})$/.exec(s);if(!m)return[12,0];var h=+m[1],mm=+m[2];return[Math.min(23,Math.max(0,h)),Math.min(59,Math.max(0,mm))];}
function JDN(y,m,d){var a=Math.floor((14-m)/12),y2=y+4800-a,m2=m+12*a-3;return d+Math.floor((153*m2+2)/5)+365*y2+Math.floor(y2/4)-Math.floor(y2/100)+Math.floor(y2/400)-32045;}
function sexIdx(j){var base=JDN(1984,2,2);var diff=j-base;var r=diff%60;if(r<0)r+=60;return r;}
function dayP(y,m,d){var idx=sexIdx(JDN(y,m,d));return [S[idx%10], B[idx%12]];}
function hourB(h){if(h>=23||h<1)return"å­";var M=["ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];return M[Math.floor((h-1)/2)];}
function hourS(ds,hb){var m={"ç”²":"ç”²","å·±":"ç”²","ä¹™":"ä¸™","åºš":"ä¸™","ä¸™":"æˆŠ","è¾›":"æˆŠ","ä¸":"åºš","å£¬":"åºš","æˆŠ":"å£¬","ç™¸":"å£¬"},base=m[ds],off={"å­":0,"ä¸‘":1,"å¯…":2,"å¯":3,"è¾°":4,"å·³":5,"åˆ":6,"æœª":7,"ç”³":8,"é…‰":9,"æˆŒ":10,"äº¥":11};return S[(S.indexOf(base)+off[hb])%10];}
function tenGod(d,o){var me=SE[d],my=SY[d],oe=SE[o],oy=SY[o]; if(oe===me)return my===oy?"æ¯”è‚©":"åŠ«è²¡"; if(GEN[oe]===me)return my===oy?"åå°":"å°ç¶¬"; if(GEN[me]===oe)return my===oy?"å‚·å®˜":"é£Ÿç¥"; if(CTL[me]===oe)return my===oy?"åè²¡":"æ­£è²¡"; if(CTL[oe]===me)return my===oy?"åå®˜":"æ­£å®˜"; return ""; }
function cnt(stems){var c={"æœ¨":0,"ç«":0,"åœŸ":0,"é‡‘":0,"æ°´":0}; for(var i=0;i<stems.length;i++){var s=stems[i]; if(SE[s]) c[SE[s]]+=1;} return c;}
function add(dst,src,w){w=w||1; for(var k in dst){dst[k]+= (src[k]||0)*w;}}
function inPairs(list,a,b){for(var i=0;i<list.length;i++){var p=list[i]; if((p[0]==a&&p[1]==b)||(p[0]==b&&p[1]==a)) return true;} return false;}

// ===== äºŒåå››ç¯€æ°—ï¼ˆå®šæ°—æ³•ãƒ»JSTï¼‰ç°¡æ˜“ =====
function toJD(date){return JDN(date.getUTCFullYear(),date.getUTCMonth()+1,date.getUTCDate()) + (date.getUTCHours()-12)/24 + date.getUTCMinutes()/1440;}
function sunLonDeg(jd){var T=(jd-2451545.0)/36525;var L0=(280.46646+36000.76983*T+0.0003032*T*T)%360;var M=357.52911+35999.05029*T-0.0001537*T*T;var C=(1.914602-0.004817*T-0.000014*T*T)*Math.sin(M*Math.PI/180)+(0.019993-0.000101*T)*Math.sin(2*M*Math.PI/180)+0.000289*Math.sin(3*M*Math.PI/180);var trueLon=L0+C;return (trueLon+360)%360;}
function findTermJST(year){
  var out=[],targets=[315,345,15,45,75,105,135,165,195,225,255,285];
  for(var i=0;i<targets.length;i++){
    var approx=new Date(Date.UTC(year, i<11?i+1:0, 4, 6, 0));
    var jd0=toJD(approx), step=0.5/24, best=jd0, last=999;
    for(var k=-240;k<=240;k++){
      var jd=jd0+k*step, lon=sunLonDeg(jd), diff=((lon - targets[i] + 540)%360)-180;
      if(Math.abs(diff)<last){last=Math.abs(diff);best=jd;}
    }
    var d=new Date((best-2440587.5)*86400000); var jst=new Date(d.getTime()+9*3600000);
    out.push(jst);
  }
  return out;
}
var meanSetu=[{m:2,d:4},{m:3,d:6},{m:4,d:5},{m:5,d:6},{m:6,d:6},{m:7,d:7},{m:8,d:7},{m:9,d:7},{m:10,d:8},{m:11,d:7},{m:12,d:7},{m:1,d:6}];
function yearP(y,m,d){try{var terms=findTermJST(y);var risshun=terms[0];var cur=new Date(y,m-1,d,12);var jy=(cur<risshun)?(y-1):y;var yi=((jy-1984)%60+60)%60;return [S[yi%10],B[yi%12]];}catch(e){var before=(m<2)||(m==2&&d<4),jy=before?y-1:y;var yi=((jy-1984)%60+60)%60;return [S[yi%10],B[yi%12]];}}
function monthP(y,m,d,ys){
  function autoIndex(){try{var terms=findTermJST(y);var cur=new Date(y,m-1,d,12);var idx=-1;for(var i=0;i<12;i++){var a=terms[i],b=(i<11?terms[i+1]:findTermJST(y+1)[0]);if(cur>=a&&cur<b){idx=i;break;}}return (idx<0)?11:idx;}catch(e){var arr=[],i;for(i=0;i<12;i++){var t=meanSetu[i],yy=y,mmm=t.m;if(mmm==1)yy=y+1;arr.push({y:yy,m:mmm,d:t.d,idx:i});}var v=y*10000+m*100+d;for(i=0;i<12;i++){var a=arr[i],tv=a.y*10000+a.m*100+a.d;if(v<tv)return (i+11)%12;}return 11;}}
  var idx=(document.getElementById("setu").value==="const")?autoIndex(): (function(){var arr=[],i;for(i=0;i<12;i++){var t=meanSetu[i],yy=y,mmm=t.m;if(mmm==1)yy=y+1;arr.push({y:yy,m:mmm,d:t.d,idx:i});}var v=y*10000+m*100+d;for(i=0;i<12;i++){var a=arr[i],tv=a.y*10000+a.m*100+a.d;if(v<tv)return (i+11)%12;}return 11;})();
  var br=MB[idx]; var map={"ç”²":"ä¸™","å·±":"ä¸™","ä¹™":"æˆŠ","åºš":"æˆŠ","ä¸™":"åºš","è¾›":"åºš","ä¸":"å£¬","å£¬":"å£¬","æˆŠ":"ç”²","ç™¸":"ç”²"}, st=map[ys], si=S.indexOf(st);
  return [S[(si+idx)%10], br];
}

// ===== æ•°ç§˜ =====
function pad(n){return (n<10?"0":"")+n;}
function reduceNum(n){n=(""+n).replace(/\D/g,"");var s=0;for(var i=0;i<n.length;i++) s+=(+n[i]);if(s===11||s===22||s===33) return s;while(s>9){var t=0;var str=""+s;for(var j=0;j<str.length;j++) t+=(+str[j]);if(t===11||t===22||t===33){s=t;break;}s=t;}return s;}
function lifePath(y,m,d){return reduceNum(""+y+pad(m)+pad(d));}
function birthdayNum(d){return (d>=10)?reduceNum(""+d):d;}
function personalYear(m,d,curY){return reduceNum(reduceNum(""+curY)+reduceNum(""+m)+reduceNum(""+d));}
function personalMonth(py, calMonth){return reduceNum(py + calMonth);}

// ç›¸æ€§ï¼ˆæ•°ç§˜ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢ä¸€éƒ¨ï¼‰
var NCbase={1:{1:70,2:78,3:85,4:76,5:82,6:74,7:80,8:88,9:75,11:86,22:84,33:80},2:{1:78,2:72,3:77,4:82,5:74,6:86,7:80,8:70,9:83,11:85,22:76,33:84},3:{1:85,2:77,3:75,4:72,5:88,6:80,7:78,8:79,9:84,11:86,22:78,33:90},4:{1:76,2:82,3:72,4:74,5:70,6:80,7:85,8:86,9:73,11:78,22:88,33:76},5:{1:82,2:74,3:88,4:70,5:76,6:73,7:80,8:78,9:84,11:86,22:80,33:82},6:{1:74,2:86,3:80,4:80,5:73,6:78,7:76,8:82,9:88,11:84,22:80,33:86},7:{1:80,2:80,3:78,4:85,5:80,6:76,7:74,8:82,9:79,11:88,22:84,33:78},8:{1:88,2:70,3:79,4:86,5:78,6:82,7:82,8:76,9:80,11:84,22:90,33:80},9:{1:75,2:83,3:84,4:73,5:84,6:88,7:79,8:80,9:76,11:86,22:82,33:88},11:{1:86,2:85,3:86,4:78,5:86,6:84,7:88,8:84,9:86,11:82,22:86,33:90},22:{1:84,2:76,3:78,4:88,5:80,6:80,7:84,8:90,9:82,11:86,22:84,33:86},33:{1:80,2:84,3:90,4:76,5:82,6:86,7:78,8:80,9:88,11:90,22:86,33:84}};

// ========== é‘‘å®š ==========
function run(){
  // å…¥åŠ›
  var y=+document.getElementById("y").value, m=+document.getElementById("m").value, d=+document.getElementById("d").value;
  var hm=document.getElementById("hm").value, t=parseHM(hm), hh=t[0];
  if(!(y>0&&m>=1&&m<=12&&d>=1&&d<=31)){document.getElementById("err").style.display="block";return;}
  document.getElementById("err").style.display="none";

  // æŸ±
  var dp=dayP(y,m,d), ds=dp[0], db=dp[1];
  var yp=yearP(y,m,d), ys=yp[0], yb=yp[1];
  var mp=monthP(y,m,d,ys), ms=mp[0], mb=mp[1];
  var hb=hourB(hh), hs=hourS(ds,hb);

  // å‘½å¼ï¼ˆè¡¨ç¤ºï¼‰
  document.getElementById("ms").innerHTML=[
    'å¹´ï¼š<b>'+ys+yb+'</b>ï¼ˆè‚²ã¡/å®¶ï¼‰','æœˆï¼š<b>'+ms+mb+'</b>ï¼ˆç¤¾ä¼š/ä»•äº‹ï¼‰','æ—¥ï¼š<b>'+ds+db+'</b>ï¼ˆä¸­å¿ƒï¼‰','æ™‚ï¼š<b>'+hs+hb+'</b>ï¼ˆè€ƒãˆ/å°†æ¥ï¼‰'
  ].map(x=>'<div class="chip">'+x+'</div>').join('');

  // å‘½å¼è¡¨ï¼ˆã‚„ã•ã—ã„èª­ã¿ï¼‰
  var TGtxt={"æ¯”è‚©":"è‡ªåˆ†ã§ã‚„ã‚‹åŠ›","åŠ«è²¡":"ä»²é–“ã¨çªç ´","é£Ÿç¥":"è¡¨ç¾ã¨æ¥½ã—ã•","å‚·å®˜":"æ”¹å–„ã¨åˆ†æ","åè²¡":"ã”ç¸ã¨ãƒãƒ£ãƒ³ã‚¹","æ­£è²¡":"ç´„æŸã¨ä¿¡é ¼","åå®˜":"æŒ‘æˆ¦ã¨è¡Œå‹•","æ­£å®˜":"å½¹å‰²ã¨è©•ä¾¡","åå°":"ã²ã‚‰ã‚ã","å°ç¶¬":"å­¦ã³ã¨ç†è§£"};
  function row(p){var tg=tenGod(ds,p[1]), easy={
    "æ¯”è‚©":"è‡ªç«‹/è‡ªåˆ†è»¸","åŠ«è²¡":"ä»²é–“ã§çªç ´","é£Ÿç¥":"æ¥½ã—ãè¡¨ç¾","å‚·å®˜":"æ”¹å–„/åˆ†æ","åè²¡":"ã”ç¸ãƒ»è¡Œå‹•","æ­£è²¡":"ç´„æŸãƒ»ä¿¡é ¼","åå®˜":"å°ã•ãæŒ‘æˆ¦","æ­£å®˜":"å½¹å‰²ãƒ»è©•ä¾¡","åå°":"ç›´æ„Ÿã‚’è©¦ã™","å°ç¶¬":"å­¦ã³ã§å¼·åŒ–"
  }[tg]||"";return '<tr><th>'+p[0]+'</th><td>'+p[1]+'</td><td>'+p[2]+'</td><td>'+tg+'</td><td>'+(TGtxt[tg]||"")+'</td><td class="small">'+p[3]+'ï½œ'+easy+'</td></tr>';}
  document.getElementById("tbl").innerHTML='<table><thead><tr><th>æŸ±</th><th>å¤©å¹²</th><th>åœ°æ”¯</th><th>é€šå¤‰æ˜Ÿ</th><th>æ„å‘³</th><th>ã‚„ã•ã—ã„èª­ã¿æ–¹</th></tr></thead><tbody>'+
    [["å¹´æŸ±",ys,yb,"å®¶ã®é›°å›²æ°—"],["æœˆæŸ±",ms,mb,"ç¤¾ä¼šã§ã®é¡”"],["æ—¥æŸ±",ds,db,"æ€§æ ¼ã®æ ¸å¿ƒ"],["æ™‚æŸ±",hs,hb,"è€ƒãˆ/å°†æ¥åƒ"]].map(row).join('')+
  '</tbody></table>';

  // äº”è¡Œï¼ˆè”µå¹²è¾¼ã¿ï¼‰
  function zWeights(z){var l=ZM[z]||[]; if(l.length==1)return[1]; if(document.getElementById("zW").value==="eq"){return l.map(()=>1/l.length);} return l.length==2?[0.65,0.35]:[0.6,0.25,0.15].slice(0,l.length);}
  var vis=cnt([ys,ms,ds,hs]), zc={"æœ¨":0,"ç«":0,"åœŸ":0,"é‡‘":0,"æ°´":0}, pillars=[[ys,yb],[ms,mb],[ds,db],[hs,hb]];
  for(var i=0;i<pillars.length;i++){var zlist=ZM[pillars[i][1]]||[], w=zWeights(pillars[i][1]); for(var j=0;j<zlist.length;j++){add(zc,cnt([zlist[j]]), w[j]||0);}}
  var useZ=document.getElementById("zOpt").value==="on", total={}; E.forEach(e=>total[e]=(vis[e]||0)+(useZ?zc[e]||0:0));
  var mx=Math.max.apply(null,E.map(e=>total[e]||0)), bars=E.map(function(e){var h=mx?Math.round((total[e]||0)/mx*140)+6:6;return '<div style="flex:1;text-align:center"><div class="bar" style="height:'+h+'px"></div><div class="small" style="padding-top:6px">'+e+' '+(total[e]||0).toFixed(2)+'</div></div>';}).join('');
  document.getElementById("bars").innerHTML=bars; var ord=E.slice().sort((a,b)=>(total[b]||0)-(total[a]||0));
  document.getElementById("fftags").innerHTML='<span class="badge">å¼·ï¼š'+ord[0]+'</span><span class="badge">å¼±ï¼š'+ord[4]+'</span>';

  var meaning={
    "æœ¨":{mean:"æˆé•·ãƒ»å­¦ã³ãƒ»ã‚„ã•ã—ã•", strong:"è‚²æˆ/ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å¤–ã¸", weak:"æœæ•£æ­©ãƒ»èª­æ›¸ã§â€œä¼¸ã³ã‚‹â€"},
    "ç«":{mean:"æƒ…ç†±ãƒ»ç™ºä¿¡ãƒ»å…ƒæ°—", strong:"å£°ã«å‡ºã™/ä¼ãˆã‚‹", weak:"ä½“ã‚’æ¸©ã‚ã‚‹ãƒ»è»½é‹å‹•"},
    "åœŸ":{mean:"å®‰å®šãƒ»è¨ˆç”»ãƒ»æ”¯ãˆã‚‹", strong:"æ®µå–ã‚Š/ç¶™ç¶šã§ä¿¡é ¼UP", weak:"å°ã•ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã§åœŸå°ã¥ãã‚Š"},
    "é‡‘":{mean:"åˆ¤æ–­ãƒ»æ•´ãˆã‚‹ãƒ»ç£¨ã", strong:"ãƒ«ãƒ¼ãƒ«/å“è³ªã§å¼·ã¿", weak:"ç‰‡ä»˜ã‘/æƒ…å ±æ•´ç†ã§ç£¨ã"},
    "æ°´":{mean:"è€ƒãˆã‚‹ãƒ»æƒ…å ±ãƒ»æµã‚Œ", strong:"åˆ†æ/IT/ä¼ãˆã‚‹â—", weak:"ãƒ¡ãƒ¢/å¯¾è©±/æ•£æ­©ã§å¾ªç’°"}
  };
  var sumVal=E.reduce((a,k)=>a+(total[k]||0),0)||1, avg=sumVal/5;
  function lv(v){if(v>=avg*1.15)return"å¼·ã‚ï¼ˆæ´»ã‹ã™ï¼‰"; if(v<=avg*0.85)return"å¼±ã‚ï¼ˆè‚²ã¦ã‚‹ï¼‰"; return"ã»ã©ã‚ˆã„ï¼ˆãã®ã¾ã¾â—ï¼‰";}
  document.getElementById("fiveExplain").innerHTML=E.map(function(k){
    var v=(total[k]||0), tip=(lv(v).indexOf("å¼·ã‚")>=0?meaning[k].strong:(lv(v).indexOf("å¼±ã‚")>=0?meaning[k].weak:"å¾—æ„ã‚’ãã®ã¾ã¾ä½¿ã†"));
    return '<div class="tag">'+k+'ï¼š'+meaning[k].mean+' ï¼ <b>'+lv(v)+'</b> â†’ '+tip+'</div>';
  }).join('');

  // ====== ç·åˆãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚° å¼·åŒ–ï¼ˆè¿½åŠ ã®ã¿ï¼‰ ======
  var tgAll={}, pillarsGan=[ys,ms,hs];
  pillarsGan.forEach(g=>{var t=tenGod(ds,g); if(t) tgAll[t]=(tgAll[t]||0)+1;});
  (ZM[db]||[]).forEach(zg=>{var t=tenGod(ds,zg); if(t) tgAll[t]=(tgAll[t]||0)+1;});
  var topTG=Object.keys(tgAll).sort((a,b)=>(tgAll[b]||0)-(tgAll[a]||0));

  // æ€§æ ¼ãƒ»æ‰èƒ½ãƒ»äººé–“é–¢ä¿‚
  var lp=lifePath(y,m,d), bd=birthdayNum(d);
  var traits=[];
  if(topTG[0]) traits.push('æ€§æ ¼ã®æ ¸ï¼š<b>'+topTG[0]+'</b>ï¼ˆ'+{"æ¯”è‚©":"è‡ªåˆ†è»¸ã§é€²ã‚€ã€ã€Œä¸€äººã§å§‹ã‚ã¦åºƒã’ã‚‹","åŠ«è²¡":"ä»²é–“ã¨å‹•ãã€ã€Œå·»ãè¾¼ã¿åŠ›ãŒéµ","é£Ÿç¥":"æ¥½ã—ãè¡¨ç¾ã€ã€Œç¬‘é¡”ã§é“ãŒé–‹ã","å‚·å®˜":"ç´°éƒ¨ã‚’æ•´ãˆã‚‹ã€ã€Œè³ªã«ã“ã ã‚ã‚‹ã¨é–‹é‹","åè²¡":"ã”ç¸ã‚’ã¤ã‹ã‚€ã€ã€Œã¾ãšå‹•ãã¨ãƒãƒ£ãƒ³ã‚¹","æ­£è²¡":"ç´„æŸã‚’å®ˆã‚‹ã€ã€Œä¿¡ç”¨ãŒæœ€å¤§ã®æ­¦å™¨","åå®˜":"æŒ‘æˆ¦ã§ä¼¸ã³ã‚‹ã€ã€Œå°ã•ãªå†’é™ºã®ç©ã¿é‡ã­","æ­£å®˜":"å½¹å‰²ã§ä¿¡é ¼ã€ã€Œãã¡ã‚“ã¨ãŒåŠ¹ã","åå°":"ã²ã‚‰ã‚ãå¤šã‚ã€ã€Œã¾ãšè©¦ã—ã¦å­¦ã¶","å°ç¶¬":"å­¦ã‚“ã§åºƒã’ã‚‹ã€ã€Œæƒ…å ±æ•´ç†ãŒé‡‘è„ˆ"}[topTG[0]]+'ï¼‰');
  if(topTG[1]) traits.push('ä¼¸ã°ã™ã‚³ãƒ„ï¼š<b>'+topTG[1]+'</b>ï¼ˆ'+{"æ¯”è‚©":"è‡ªåˆ†ã§æ±ºã‚ã‚‹æ™‚é–“ã‚’ç¢ºä¿","åŠ«è²¡":"åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ç·´ç¿’","é£Ÿç¥":"éŠã³ã®äºˆå®šã‚’å…¥ã‚Œã‚‹","å‚·å®˜":"æ”¹å–„ãƒªã‚¹ãƒˆâ†’å®Ÿè¡Œ","åè²¡":"1æ—¥1ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¤–ã¸","æ­£è²¡":"ç· åˆ‡ã¨ç´„æŸã‚’å‘³æ–¹ã«","åå®˜":"å°ã•ãæŒ‘æˆ¦â†’ã™ããƒ¬ãƒ“ãƒ¥ãƒ¼","æ­£å®˜":"å½¹å‰²ã‚’æ˜ç¢ºåŒ–","åå°":"ç›´æ„Ÿãƒ¡ãƒ¢ã‚’å®Ÿé¨“","å°ç¶¬":"å­¦ã³â†’è¦ç´„â†’å…±æœ‰"}[topTG[1]]+'ï¼‰');
  traits.push('äººé–“é–¢ä¿‚ï¼š<b>'+(SE[ds]===SE[ms]?"ä¼¼ãŸå¼·ã¿åŒå£«ã€è¤’ã‚åˆã„ãŒéµ":"é•ã„ã¯å½¹å‰²åˆ†æ‹…ã«å¤‰ãˆã‚‹ã¨å¼·ã„")+'</b>');
  document.getElementById("traits").innerHTML=traits.map(x=>'<div class="tag">'+x+'</div>').join('');

  // æ‹æ„›è¦³ï¼ˆå››æŸ±ï¼‹æ•°ç§˜ï¼‰æ·±æ˜ã‚Š
  var loveLines=[];
  loveLines.push('æ•°ç§˜ï¼šé‹å‘½æ•°<b>'+lp+'</b> â†’ '+({1:"ä¸»å°å‹ã€‚ç´ ç›´ãªãŠé¡˜ã„ãŒåŠ¹ã",2:"å¯„ã‚Šæ·»ã„å‹ã€‚å¢ƒç•Œç·šã‚’å¿˜ã‚Œãªã„",3:"æ¥½ã—ã„æ‹ã€‚ã‚¤ãƒ™ãƒ³ãƒˆãŒç¸ã‚’å‘¼ã¶",4:"å®‰å®šé‡è¦–ã€‚ä¸å¯§ãªæ®µå–ã‚ŠãŒå‰",5:"è‡ªç”±æ´¾ã€‚æŸç¸›ã—ãªã„ç´„æŸã‚’",6:"ä¸–è©±ç„¼ãã€‚æŠ±ãˆè¾¼ã¿ã™ãæ³¨æ„",7:"ä¸€äººæ™‚é–“ãŒç‡ƒæ–™ã€‚ç†è§£è€…ãŒâ—",8:"é ¼ã‚Œã‚‹ã€‚å¼·å¼•ã•ã«æ°—ã‚’ä»˜ã‘ã¦",9:"å…±æ„Ÿå‹ã€‚æ„Ÿæƒ…ã®ç½®ãå ´æ‰€ã‚’",11:"å¿ƒã®é€šã„åˆã„é‡è¦–ã€‚ç„¦ã‚‰ãš",22:"å¤§ããªç›®æ¨™ã‚’å…±æœ‰ã§çµ†UP",33:"åŒ…å®¹åŠ›ã€‚è‡ªåˆ†ã®ã‚±ã‚¢ã‚‚å¿˜ã‚Œãš"})[lp]);
  var peach=PEACH_BY_DAY[db]; if(peach) loveLines.push('å››æŸ±ï¼šæ—¥æ”¯<b>'+db+'</b>ã®æ¡ƒèŠ±ã¯<b>'+peach+'</b>ã€‚ãã®æœˆã‚„ãã®å¹²æ”¯ã®äººã¯å‡ºä¼šã„é‹UPã€‚');
  loveLines.push('é€²ã‚æ–¹ï¼š<b>'+({"æœ¨":"ä¼šè©±ã‚’é‡ã­ã¦è‚²ã¦ã‚‹","ç«":"æ°—æŒã¡ã‚’è¨€è‘‰ã«ã—ã¦ä¼ãˆã‚‹","åœŸ":"ç´„æŸã¨å®‰å¿ƒæ„Ÿã‚’ç©ã¿ä¸Šã’ã‚‹","é‡‘":"ãƒãƒŠãƒ¼ã¨ä¸å¯§ã•ã§æƒšã‚Œã‚‰ã‚Œã‚‹","æ°´":"å…±é€šã®èˆˆå‘³ã§ã¤ãªãŒã‚‹"}[SE[ds]])+'</b>');
  document.getElementById("loveView").innerHTML=loveLines.map(x=>'<div class="note" style="margin:4px 0">'+x+'</div>').join("");

  // ãŠã™ã™ã‚ãƒ“ã‚¸ãƒã‚¹ï¼åƒãæ–¹ï¼ˆå¼·åŒ–ï¼‰
  var strong=ord[0], weak=ord[4];
  var bizMap={"æœ¨":"æ•™è‚²/è‚²æˆ/ä¼ç”»","ç«":"åºƒå ±/è²©å£²/ã‚¨ãƒ³ã‚¿ãƒ¡","åœŸ":"ç®¡ç†/ç·å‹™/å“è³ª","é‡‘":"æ³•å‹™/è²¡å‹™/å¯©æŸ»/ãƒ‡ã‚¶ã‚¤ãƒ³","æ°´":"IT/æƒ…å ±/ç ”ç©¶/ä¼é”"};
  var lpJob={
    1:"èµ·æ¥­/å–¶æ¥­/ä¼ç”»/ç®¡ç†",
    2:"äººäº‹/ç§˜æ›¸/æ¥å®¢/ã‚±ã‚¢",
    3:"ãƒ‡ã‚¶ã‚¤ãƒ³/åºƒå ±/æ•™è‚²",
    4:"çµŒç†/è¡Œæ”¿/å»ºç¯‰/å“è³ª",
    5:"å–¶æ¥­/æ—…è¡Œ/ãƒãƒ¼ã‚±/é€šè¨³",
    6:"åŒ»ç™‚/ç¦ç¥‰/ç¾å®¹/æ•™è‚²",
    7:"ç ”ç©¶/åˆ†æ/é–‹ç™º/ã‚³ãƒ³ã‚µãƒ«",
    8:"ç®¡ç†è·/ä¸å‹•ç”£/é‡‘è",
    9:"æ•™è‚²/ç¦ç¥‰/ä¼ç”»/åºƒå ±",
    11:"ã‚¢ãƒ¼ãƒˆ/è¡¨ç¾/ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°",
    22:"çµŒå–¶/ç¤¾ä¼šäº‹æ¥­/å»ºè¨­/ä»•çµ„ã¿åŒ–",
    33:"æ•™è‚²/ã‚±ã‚¢/è¡¨ç¾/ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£"
  };
  var roleTip={"æœ¨":"ä¼ç”»/è‚²æˆã®å½¹","ç«":"åºƒå ±/æ¨é€²ã®å½¹","åœŸ":"é€²è¡Œ/å“è³ªã®å½¹","é‡‘":"ç›£æŸ»/æ•´å‚™ã®å½¹","æ°´":"æƒ…å ±/åˆ†æã®å½¹"}[strong];
  document.getElementById("business").innerHTML=[
    'äº”è¡Œã®å¼·ã¿ï¼š<b>'+strong+'</b> â†’ '+bizMap[strong],
    'æ•°ç§˜ã®é©è·ï¼š<b>'+lp+'</b> â†’ '+lpJob[lp],
    'ãƒãƒ¼ãƒ ã§ã®å½¹å‰²ï¼š<b>'+roleTip+'</b>',
    'å¼±ã¿ï¼ˆè‚²ã¦ã‚‹ï¼‰ï¼š<b>'+weak+'</b> â†’ '+{"æœ¨":"æœæ—¥ã¨ã‚¹ãƒˆãƒ¬ãƒƒãƒ","ç«":"å£°å‡ºã—/ä½“ã‚’æ¸©ã‚ã‚‹","åœŸ":"å°ã•ãªãƒ«ãƒ¼ãƒ«ä½œã‚Š","é‡‘":"ç‰‡ä»˜ã‘5åˆ†/æƒ…å ±æ•´ç†","æ°´":"ãƒ¡ãƒ¢ã¨å¯¾è©±ã®ç¿’æ…£"}[weak]
  ].map(x=>'<div class="note" style="margin:4px 0">'+x+'</div>').join("");

  // é•·æ‰€ãƒ»çŸ­æ‰€ï¼ˆä½¿ã„æ–¹ã®ã‚³ãƒ„ å¼·åŒ–ï¼‰
  var strengths=[
    'é•·æ‰€ï¼š<b>'+strong+'</b>ã®è‰¯ã•ï¼ˆ'+{"æœ¨":"å„ªã—ã•ãƒ»æˆé•·åŠ›","ç«":"æƒ…ç†±ãƒ»ç™ºä¿¡åŠ›","åœŸ":"å®‰å®šãƒ»æ®µå–ã‚Š","é‡‘":"åˆ¤æ–­ãƒ»æ•´ãˆã‚‹åŠ›","æ°´":"åˆ†æãƒ»ä¼é”"}[strong]+'ï¼‰ã‚’å‰ã¸',
    'çŸ­æ‰€ï¼š<b>'+weak+'</b>ãŒè¶³ã‚Šã‚„ã™ã„ â†’ '+
      {"æœ¨":"æœæ•£æ­©/å­¦ã³ã‚’è¶³ã™","ç«":"ä½“ã‚’æ¸©ã‚å£°ã«å‡ºã™","åœŸ":"å°ã•ãªãƒ«ãƒ¼ãƒ«ä½œã‚Š","é‡‘":"ç‰‡ä»˜ã‘/æƒ…å ±æ•´ç†","æ°´":"ãƒ¡ãƒ¢/å¯¾è©±ã§æµã‚Œä½œã‚Š"}[weak],
    'åˆè¨€è‘‰ï¼š<b>'+({"æœ¨":"è‚²ã¦ã¦ä¼¸ã°ã™","ç«":"ä¼ãˆã¦å‹•ã","åœŸ":"æ•´ãˆã¦ç¶šã‘ã‚‹","é‡‘":"ç£¨ã„ã¦çµã‚‹","æ°´":"ã¤ãªã„ã§å·¡ã‚‰ã™"}[strong])+'</b> ã¨é‹ãŒä¼¸ã³ã‚‹'
  ];
  if(topTG[0]==="å‚·å®˜") strengths.push('æ³¨æ„ï¼šæ‰¹åˆ¤ãŒå¼·ããªã‚Šã‚„ã™ã„ â†’ æ™‚é–“ã‚’åŒºåˆ‡ã£ã¦â€œæ”¹å–„â†’å®Ÿè¡Œâ€ã€‚');
  if(topTG[0]==="åå®˜") strengths.push('æ³¨æ„ï¼šçªã£èµ°ã‚Šã™ãæ³¨æ„ â†’ å°ã•ãæŒ‘æˆ¦â†’ç· åˆ‡ã§æ•´ãˆã‚‹ã€‚');
  if(topTG[0]==="æ­£è²¡") strengths.push('æ³¨æ„ï¼šæŠ±ãˆè¾¼ã¿ â†’ å½¹å‰²åˆ†æ‹…ã¨ç· åˆ‡å…±æœ‰ã§æ¥½ã«ã€‚');
  document.getElementById("strengths").innerHTML=strengths.map(x=>'<div class="note" style="margin:4px 0">'+x+'</div>').join("");

  // æ·±æ˜ã‚Šãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ†ãƒ¼ãƒï¼‰
  var theme=({"æœ¨":"äººã‚’è‚²ã¦ã‚‹å…ˆç”Ÿã‚¿ã‚¤ãƒ—","ç«":"å‘¨ã‚Šã‚’æ˜ã‚‹ãã™ã‚‹å¤ªé™½ã‚¿ã‚¤ãƒ—","åœŸ":"åœŸå°ã‚’ä½œã‚‹è·äººã‚¿ã‚¤ãƒ—","é‡‘":"æ•´ãˆã¦ç¾ã—ãã™ã‚‹å¯©ç¾ã‚¿ã‚¤ãƒ—","æ°´":"æƒ…å ±ã‚’ã¤ãªããƒŠãƒ“ã‚¿ã‚¤ãƒ—"}[strong]);
  var deep = 'äººç”Ÿã®ãƒ†ãƒ¼ãƒï¼š<b>'+theme+'</b>ã€‚' +
             'ä»ŠæœŸã¯ã€Œ'+({"æ¯”è‚©":"è‡ªåˆ†ã§æ±ºã‚ã¦é€²ã‚€","åŠ«è²¡":"ä»²é–“ã¨å”åŠ›ã™ã‚‹","é£Ÿç¥":"æ¥½ã—ãè¡¨ç¾ã™ã‚‹","å‚·å®˜":"è³ªã‚’é«˜ã‚ã‚‹","åè²¡":"å¤–ã¸å‡ºã¦ã”ç¸ã‚’åºƒã’ã‚‹","æ­£è²¡":"ä¿¡ç”¨ã‚’ç©ã‚€","åå®˜":"å°ã•ãæŒ‘æˆ¦ã™ã‚‹","æ­£å®˜":"å½¹å‰²ã‚’æ˜ç¢ºã«ã™ã‚‹","åå°":"ã²ã‚‰ã‚ãã‚’è©¦ã™","å°ç¶¬":"å­¦ã³ã‚’å½¢ã«ã™ã‚‹"}[topTG[0]]||"æµã‚Œã«ä¹—ã‚‹")+'ã€ãŒéµã€‚';
  document.getElementById("deepRead").innerHTML=deep;

  // ===== ç›¸æ€§ãƒœã‚¿ãƒ³ï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®ã¾ã¾ï¼‰ =====
  document.getElementById("compatBtn").onclick=function(){
    var y2=+document.getElementById("py2").value, m2=+document.getElementById("pm2").value, d2=+document.getElementById("pd2").value;
    var hm2=document.getElementById("phm2").value||"12:00", t2=parseHM(hm2), hh2=t2[0];
    if(!(y2>0&&m2>=1&&m2<=12&&d2>=1&&d2<=31)){document.getElementById("compatOut").innerHTML="<div class='err' style='display:block'>ç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ã‚’æ­£ã—ãå…¥ã‚Œã¦ã­</div>"; return;}
    var dp2=dayP(y2,m2,d2), ds2=dp2[0], db2=dp2[1]; var hb2=hourB(hh2), hs2=hourS(ds2,hb2);
    function gScore(a,b){var s=50,ea=SE[a],eb=SE[b]; if(GEN[ea]===eb)s+=12; if(GEN[eb]===ea)s+=12; if(CTL[ea]===eb)s-=14; if(CTL[eb]===ea)s-=14; if(SY[a]===SY[b])s+=6; else s-=4;return Math.max(0,Math.min(100,s));}
    var H={ "å…­åˆ":HEX, "å†²":CHONG, "å®³":[["å­","æœª"],["ä¸‘","åˆ"],["å¯…","å·³"],["å¯","è¾°"],["ç”³","äº¥"],["é…‰","æˆŒ"]] };
    function zScore(a,b){var s=50; if(inPairs(H["å…­åˆ"],a,b))s+=20; if(inPairs(H["å†²"],a,b))s-=18; if(inPairs(H["å®³"],a,b))s-=8; return Math.max(0,Math.min(100,s));}
    var siJuScore=Math.round(gScore(ds,ds2)*0.6 + zScore(db,db2)*0.4);
    var lp1=lifePath(y,m,d), lp2=lifePath(y2,m2,d2), numScore=(NCbase[lp1]&&NCbase[lp1][lp2])||75;
    var loveScore=Math.round(siJuScore*0.65 + numScore*0.35);
    var friendScore=Math.round(siJuScore*0.5 + numScore*0.5);
    var roleBoost=0; if(GEN[SE[ds]]===SE[ds2]) roleBoost+=4; if(CTL[SE[ds]]===SE[ds2]) roleBoost+=3;
    var bizScore=Math.max(0,Math.min(100, Math.round(siJuScore*0.6 + numScore*0.4 + roleBoost)));
    function face(s){return s>=86?"â—":(s>=80?"â—¯":(s>=74?"â–³":"â–²"));}
    function loveAdvice(s){var a=[]; if(s<75)a.push("â€œæ°—æŒã¡â†’ç†ç”±â†’ææ¡ˆâ€ã®é †ã§è©±ã™ã€‚"); if(inPairs(HEX, db, db2))a.push("â€œå…­åˆâ€ã§ä¼šã†å›æ•°ã‚’å¢—ã‚„ã™ã€‚"); if(inPairs(CHONG, db, db2))a.push("å…ˆã«å…±é€šã‚´ãƒ¼ãƒ«ã‚’æ±ºã‚ã¦ã‹ã‚‰è©±ã™ã€‚"); return a.join(" ");}
    function friendAdvice(s){var a=[]; if(s<75)a.push("é€£çµ¡é »åº¦ï¼ˆé€±1/éš”é€±ï¼‰ã‚’åˆæ„ã€‚"); a.push((CTL[SE[ds]]===SE[ds2]||CTL[SE[ds2]]===SE[ds])?"æ‹…å½“ã‚’åˆ†ã‘ã‚‹ï¼ˆä¼ç”»/ã¾ã¨ã‚/é€£çµ¡ï¼‰ã€‚":"å…±é€šã®è¶£å‘³æ™‚é–“ã‚’å›ºå®šã€‚"); return a.join(" ");}
    function bizAdvice(s){var a=[]; if(GEN[SE[ds]]===SE[ds2])a.push("ã‚ãªãŸâ†’ç›¸æ‰‹ã‚’è‚²ã¦ã‚‹ï¼šã‚³ãƒ¼ãƒå½¹ã€‚"); if(CTL[SE[ds]]===SE[ds2])a.push("ã‚ãªãŸâ†’ç›¸æ‰‹ã‚’ç®¡ç†ï¼šKPI/ç· åˆ‡è¨­è¨ˆã€‚"); if(CTL[SE[ds2]]===SE[ds])a.push("ç›¸æ‰‹â†’ã‚ãªãŸã‚’ç®¡ç†ï¼šç· åˆ‡ä¿‚ã‚’ç›¸æ‰‹ã«ã€‚"); if(s<75)a.push("ä¼šè­°ã¯â€œæ±ºã‚ã‚‹äººâ†’é †â†’æœŸé™â€ã‚’æœ€åˆã«å®£è¨€ã€‚"); return a.join(" ");}
    var html=''; html+='<div class="kv"><div class="chip">ã‚ãªãŸï¼š<b>'+ds+db+'</b> / é‹å‘½æ•°<b>'+lp1+'</b></div><div class="chip">ç›¸æ‰‹ï¼š<b>'+ds2+db2+'</b> / é‹å‘½æ•°<b>'+lp2+'</b></div></div><div class="hr"></div>';
    html+='<div><b>å››æŸ±ã®ç›¸æ€§</b>ï¼š'+siJuScore+'/100ã€€<b>æ•°ç§˜ã®ç›¸æ€§</b>ï¼š'+numScore+'/100</div><div class="hr"></div>';
    html+='<div><b>ç·åˆï¼ˆæ‹æ„›ï¼‰</b>ï¼š'+loveScore+'/100 '+face(loveScore)+'<br><span class="small">'+loveAdvice(loveScore)+'</span></div>';
    html+='<div style="margin-top:6px"><b>ç·åˆï¼ˆå‹æƒ…ï¼‰</b>ï¼š'+friendScore+'/100 '+face(friendScore)+'<br><span class="small">'+friendAdvice(friendScore)+'</span></div>';
    html+='<div style="margin-top:6px"><b>ç·åˆï¼ˆãƒ“ã‚¸ãƒã‚¹ï¼‰</b>ï¼š'+bizScore+'/100 '+face(bizScore)+'<br><span class="small">'+bizAdvice(bizScore)+'</span></div>';
    document.getElementById("compatOut").innerHTML=html;
  };

  // ====== æ™‚æœŸåˆ¤å®šï¼ˆã“ã‚Œã‹ã‚‰3å¹´ï¼š36ã‹æœˆï¼‰ ======
  function bestNumMonths(kind){var sets={love:[2,3,6], meet:[3,5], job:[1,5,8], ind:[1,8]}; return sets[kind||'love']||[2,3,6];}
  var meE=SE[ds], wealthE=CTL[meE];
  var controlsMeE=(function(){for(var k in CTL){if(CTL[k]===meE)return k;}return null;})();
  function monthBranch(y,m,d){ return monthP(y,m,d,yearP(y,m,d)[0])[1]; }

  var today=new Date(), startY=today.getFullYear(), startM=today.getMonth()+1;
  var cells=[], marryMonths=[];
  for(var i=0;i<36;i++){ // â˜… 3å¹´åˆ†
    var Y=startY+Math.floor((startM-1+i)/12);
    var M=((startM-1+i)%12)+1;

    var br=monthBranch(Y,M,15), brE=BR_E[br];
    var curPY=personalYear(m,d,Y), pm=personalMonth(curPY,M);

    var numLove=bestNumMonths('love').indexOf(pm)>=0;
    var numMeet=bestNumMonths('meet').indexOf(pm)>=0;
    var numJob =bestNumMonths('job').indexOf(pm)>=0;
    var numInd =bestNumMonths('ind').indexOf(pm)>=0;

    var siMeet = (br===PEACH_BY_DAY[db]);    // å‡ºä¼šã„ï¼ˆæ¡ƒèŠ±ï¼‰
    var siLove = (brE===wealthE) || siMeet;  // æ‹æ„›/çµå©šï¼šè²¡oræ¡ƒèŠ±
    var siJob  = (brE===controlsMeE);        // è»¢è·ï¼šå®˜
    var siInd  = (brE===wealthE) || (SE[ms]===meE); // ç‹¬ç«‹ï¼šè²¡ or è‡ªåˆ†å¼·åŒ–

    function cls(b1,b2){return b1&&b2?"hitBoth":(b1?"hitNum":(b2?"hitSi":""));}

    // çµå©šã«ç‰¹ã«è‰¯ã„æœˆï¼ˆæ•°ç§˜ãƒ»å››æŸ±ã®ã©ã¡ã‚‰ã‹ãŒæ‹æ„›â—ï¼‹å‡ºä¼šã„ or å››æŸ±å´æ‹æ„›â—ï¼‰
    var marryHit = ( (numLove && siLove) || (siLove && siMeet) || (numLove && siMeet) );

    var divCls=cls((numLove||numMeet||numJob||numInd),(siLove||siJob||siInd)) + (marryHit?' marry':'');
    var label=Y+"å¹´"+M+"æœˆï¼ˆ"+br+"ï¼‰";
    var detail=[];
    if(numLove||siLove) detail.push("æ‹æ„›â—");
    if(numMeet||siMeet) detail.push("å‡ºä¼šã„â—");
    if(numJob ||siJob ) detail.push("è»¢è·â—");
    if(numInd ||siInd ) detail.push("ç‹¬ç«‹â—");
    if(marryHit) { detail.push("ğŸ’çµå©šâ—"); marryMonths.push(label); }
    if(detail.length===0) detail.push("æ§˜å­è¦‹");

    cells.push('<div class="km '+divCls+'"><b>'+label+'</b>'+detail.join("ãƒ»")+'</div>');
  }
  document.getElementById("timing").innerHTML=cells.join('');
  document.getElementById("timingLegend").innerHTML="â€» â€œæ‹/çµå©šâ€ã¯æ•°ç§˜ï¼ˆ2/3/6ï¼‰ï¼‹å››æŸ±ã®è²¡ã®æœˆ/æ¡ƒèŠ±æœˆã€â€œè»¢è·â€ã¯æ•°ç§˜ï¼ˆ1/5/8ï¼‰ï¼‹å››æŸ±ã®å®˜ã®æœˆã€â€œç‹¬ç«‹â€ã¯æ•°ç§˜ï¼ˆ1/8ï¼‰ï¼‹å››æŸ±ã®è²¡/è‡ªåˆ†å¼·åŒ–ã§åˆ¤å®šã€‚è‰²ã¯Wâ—/æ•°ç§˜â—/å››æŸ±â—ã‚’ç¤ºã™ã€‚";
  document.getElementById("marryList").innerHTML = (marryMonths.length? "ğŸ’ <b>çµå©šã«è‰¯ã„æœˆï¼š</b> "+marryMonths.join("ã€") : "ğŸ’ çµå©šã¯ç„¦ã‚‰ãšã€æº–å‚™ã®å¹´ã€‚");
}

// åˆæœŸåŒ–
function init(){ document.getElementById("run").addEventListener("click",run); document.getElementById("compatBtn").addEventListener("click",function(){}); run(); }
document.addEventListener("DOMContentLoaded",init);
</script>
</body></html>
