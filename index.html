<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ã‚ãªãŸã®é‘‘å®šï½œæ•°ç§˜ï¼‹å®¿æ›œï¼ˆ36ãƒ¶æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œãƒ»é¢¨æ°´ãªã—ï¼‰</title>
<style>
  :root{
    --bg:#0b0f14;--ink:#eaf1ff;--muted:#9fb1cf;--line:#223049;
    --panel:#111826;--panel2:#0c1728;--accent:#22d3ee;--accent2:#34d399;
    --love:#f472b6;--meet:#34d399;--marry:#fbbf24;--move:#60a5fa;--job:#c084fc;--work:#ffd580;--promo:#a5b4fc;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#05080c;color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;line-height:1.95}
  header{padding:26px 16px;text-align:center;background:linear-gradient(180deg,#0a0f13,#0a1320)}
  header h1{margin:0 0 6px;font-size:24px;letter-spacing:.04em}
  header p{margin:0;color:var(--muted)}
  main{max-width:1120px;margin:0 auto;padding:16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:18px;margin:14px 0;box-shadow:0 8px 24px rgba(0,0,0,.26)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0b1422;color:var(--ink)}
  button{cursor:pointer;background:linear-gradient(45deg,var(--accent),var(--accent2));border:none;font-weight:700}
  h2{margin:0 0 10px;font-size:20px}
  h3{margin:12px 0 6px;font-size:17px}
  p{margin:.55em 0}
  .muted{color:var(--muted)} .small{font-size:12px}
  .box{background:var(--panel2);border:1px dashed #27405f;padding:12px;border-radius:10px;margin:.6em 0}
  .lead{font-size:15px}
  .pill{display:inline-block;border:1px solid var(--line);padding:3px 10px;border-radius:999px;color:var(--muted);font-size:12px}
  .row{display:grid;gap:12px}
  @media(min-width:900px){.row{grid-template-columns:1fr 1fr}}
  .calendar{display:grid;gap:12px}
  .calendar{grid-template-columns:1fr}
  @media(min-width:680px){.calendar{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:960px){.calendar{grid-template-columns:repeat(3,1fr)}}
  .mon{border:1px solid var(--line);border-radius:12px;padding:10px;background:#0b1422;position:relative}
  .mon.now{outline:2px solid var(--accent);box-shadow:0 0 0 4px rgba(34,211,238,.2)}
  .head{display:flex;justify-content:space-between;align-items:center}
  .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
  .tag{display:inline-flex;align-items:center;gap:4px;font-size:11px;border:1px solid var(--line);border-radius:6px;padding:2px 6px}
  .t-love{color:var(--love)}
  .t-meet{color:var(--meet)}
  .t-marry{color:var(--marry)}
  .t-move{color:var(--move)}
  .t-job{color:var(--job)}
  .t-work{color:var(--work)}
  .t-promo{color:var(--promo)}
  .hr{height:1px;background:#1e2d44;margin:10px 0}
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .filters label{border:1px solid var(--line);padding:6px 10px;border-radius:999px;cursor:pointer;background:#0b1422}
  .inline-hint{display:flex;flex-wrap:wrap;gap:8px}
</style>
</head>
<body>
<header>
  <h1>ã‚ãªãŸã®é‘‘å®šï½œå‘½ãƒ»é‹ãƒ»åœ Ã— æ•°ç§˜ï¼‹å®¿æ›œ</h1>
  <p>èª­ã¿ã‚„ã™ãã€ã™ãå®Ÿè¡Œã§ãã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€‚æ‹æ„›ãƒ»ä»•äº‹ãƒ»æ„å‘³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆé¢¨æ°´ãªã—ï¼‰ã€‚</p>
</header>

<main>
  <!-- å…¥åŠ› -->
  <div class="card">
    <div class="row">
      <div>
        <label>ã‚ãªãŸã®ç”Ÿå¹´æœˆæ—¥</label>
        <input type="date" id="birthA"/>
        <div class="row">
          <div>
            <label>å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label>
            <input type="time" id="timeA" step="60"/>
          </div>
          <div>
            <label>æ€§åˆ¥ï¼ˆä»»æ„ï½œæ–‡ä½“ã«åæ˜ ï¼‰</label>
            <select id="genderA">
              <option value="">æŒ‡å®šãªã—</option>
              <option value="female">å¥³æ€§</option>
              <option value="male">ç”·æ€§</option>
            </select>
          </div>
        </div>
        <p class="small muted">â€»å®¿æ›œã¯æœˆã®é»„çµŒã‹ã‚‰27å®¿ã‚’ç®—å‡ºï¼ˆMeeusç³»ç°¡æ˜“æ³•ï¼‰ã€‚æ™‚åˆ»ä¸æ˜ã¯æ­£åˆæ¨å®šã€‚</p>
      </div>
      <div>
        <label>ç›¸æ€§ï¼ˆæ‹æ„›ï¼‰ã‚’è¦‹ã‚‹ï¼šç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆä»»æ„ï¼‰</label>
        <input type="date" id="birthB"/>
        <div class="row">
          <div>
            <label>ç›¸æ‰‹ã®å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label>
            <input type="time" id="timeB" step="60"/>
          </div>
          <div>
            <label>ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³</label>
            <select id="tz">
              <option value="">è‡ªå‹•ï¼ˆç«¯æœ«TZï¼‰</option>
              <option value="9">æ—¥æœ¬ï¼ˆUTC+9ï¼‰</option>
              <option value="0">UTCÂ±0</option>
              <option value="-5">NYï¼ˆUTC-5ï¼‰</option>
              <option value="1">CETï¼ˆUTC+1ï¼‰</option>
            </select>
          </div>
        </div>
        <div style="margin-top:10px"><button id="run">é‘‘å®šã™ã‚‹</button></div>
      </div>
    </div>
    <div class="hr"></div>
    <div class="inline-hint small muted">
      <span>ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ï¼š<strong id="lifePath">â€”</strong></span>
      <span>æœ¬å‘½å®¿ï¼š<strong id="shukuA">â€”</strong></span>
      <span>ä»Šå¹´ã®å€‹äººå¹´ï¼š<strong id="pyear">â€”</strong></span>
    </div>
  </div>

  <!-- ä»•äº‹ -->
  <div class="card" id="secWork">
    <h2>ä»•äº‹ï½œæ‰èƒ½ã¨å‘ã„ã¦ã„ã‚‹è·æ¥­ï¼ˆå…·ä½“åï¼‰</h2>
    <div id="sectionWork"></div>
  </div>

  <!-- æ‹æ„› -->
  <div class="card" id="secLove">
    <h2>æ‹æ„›ï½œæƒ¹ã‹ã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒ— & å®¿æ›œÃ—æ•°ç§˜ ç›¸æ€§ã‚¹ã‚³ã‚¢</h2>
    <div id="sectionLove"></div>
    <div class="box" id="compat"></div>
    <p class="small muted">â€»ç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ã‚’å…¥ã‚Œã‚‹ã¨ã€å®¿æ›œï¼‹æ•°ç§˜ã§ç‚¹æ•°åŒ–ã—ãŸç›¸æ€§ã¨ã€é•·æ–‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
  </div>

  <!-- æ„å‘³ãƒ»ä½¿å‘½ -->
  <div class="card" id="secMeaning">
    <h2>ç”Ÿã¾ã‚Œã¦ããŸæ„å‘³ãƒ»ä½¿å‘½ï¼ˆå¿ƒã«å±Šãèª­ã¿ï¼‰</h2>
    <div id="sectionMeaning"></div>
  </div>

  <!-- åœï¼šä»Šæœˆï¼†æ¥æœˆ -->
  <div class="card" id="secBoku">
    <h2>ä»Šæœˆã¨æ¥æœˆã®ãƒ†ãƒ¼ãƒï¼ˆåœï¼‰</h2>
    <div id="sectionBoku"></div>
  </div>

  <!-- 36ãƒ¶æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
  <div class="card" id="secCal">
    <h2>äºˆå®šã‚’çµ„ã¿ã‚„ã™ã„36ãƒ¶æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
    <div class="small muted">
      ã€Œå€‹äººæœˆï¼ˆ1ã€œ9ï¼‰ã€ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€<strong>ã‚ã‹ã‚Šã‚„ã™ã„è¨€è‘‰ã‚¿ã‚°</strong>ã§è¡¨ç¤ºã€‚å„æœˆã¯æœ€å¤§3ã‚¿ã‚°ã¾ã§ï¼ˆæ‹æ„›ï¼å‡ºä¼šã„ï¼çµå©šï¼å¼•è¶Šã—ï¼è»¢è·ï¼ä»•äº‹é‹ï¼æ˜‡æ ¼ï¼‰ã€‚
    </div>
    <div class="filters small" style="margin-top:8px">
      <label><input type="checkbox" class="ft" value="love" checked> æ‹æ„›</label>
      <label><input type="checkbox" class="ft" value="meet" checked> å‡ºä¼šã„</label>
      <label><input type="checkbox" class="ft" value="marry" checked> çµå©š</label>
      <label><input type="checkbox" class="ft" value="move" checked> å¼•è¶Šã—</label>
      <label><input type="checkbox" class="ft" value="job" checked> è»¢è·</label>
      <label><input type="checkbox" class="ft" value="work" checked> ä»•äº‹é‹</label>
      <label><input type="checkbox" class="ft" value="promo" checked> æ˜‡æ ¼</label>
      <button id="applyFilter" style="max-width:140px;margin-left:auto">åæ˜ </button>
    </div>
    <div id="calendar" class="calendar" style="margin-top:10px"></div>
  </div>

  <div class="card small muted">
    <strong>å…è²¬ï¼š</strong>æœ¬ãƒ„ãƒ¼ãƒ«ã¯è‡ªå·±ç†è§£ã¨è¡Œå‹•ã®ãƒ’ãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚åŒ»ç™‚ãƒ»æ³•å‹™ãƒ»æŠ•è³‡åˆ¤æ–­ã®ä»£æ›¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æš¦ã‚„æµæ´¾ã«ã‚ˆã‚Šå·®ç•°ãŒå‡ºã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
  </div>
</main>

<script>
/* ========= åŸºæœ¬ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ========= */
const d2r=d=>d*Math.PI/180, norm360=x=>(x%360+360)%360;
function toDateTZ(dateStr,timeStr,tzHours){
  const [y,m,d]=dateStr.split("-").map(Number);
  let H=12,MIN=0; if(timeStr){const t=timeStr.split(":");H=+t[0];MIN=+t[1];}
  const tz=(tzHours==null||tzHours==="")?-(new Date().getTimezoneOffset()/60):Number(tzHours);
  return new Date(Date.UTC(y,m-1,d,H - tz,MIN));
}
function JD(utc){
  const y=utc.getUTCFullYear(), m=utc.getUTCMonth()+1;
  const D=utc.getUTCDate()+(utc.getUTCHours()+utc.getUTCMinutes()/60)/24;
  let Y=y,M=m; if(M<=2){Y--;M+=12;}
  const A=Math.floor(Y/100), B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(Y+4716))+Math.floor(30.6001*(M+1))+D+B-1524.5;
}

/* ========= å®¿æ›œï¼ˆé»„çµŒâ†’27å®¿ï¼‰ ========= */
function moonLon(utc){
  const t=(JD(utc)-2451545)/36525;
  const L0=norm360(218.3164477+481267.88123421*t-0.0015786*t*t+t*t*t/538841-t*t*t*t/65194000);
  const D =norm360(297.8501921+445267.1114034*t-0.0018819*t*t+t*t*t/545868-t*t*t*t/113065000);
  const M =norm360(357.5291092+35999.0502909*t-0.0001536*t*t+t*t*t/24490000);
  const M1=norm360(134.9633964+477198.8675055*t+0.0087414*t*t+t*t*t/69699-t*t*t*t/14712000);
  const F =norm360(93.2720950 +483202.0175233*t-0.0036539*t*t-t*t*t/3526000+t*t*t*t/863310000);
  let lon=L0
    +6.289*Math.sin(d2r(M1))
    +1.274*Math.sin(d2r(2*D-M1))
    +0.658*Math.sin(d2r(2*D))
    +0.214*Math.sin(d2r(2*M1))
    +0.186*Math.sin(d2r(M))
    -0.114*Math.sin(d2r(2*F));
  return norm360(lon);
}
const SHUKU=["è§’æœ¨è›Ÿ","äº¢é‡‘é¾","æ°åœŸè²‰","æˆ¿æ—¥å…","å¿ƒæœˆç‹","å°¾ç«è™","ç®•æ°´è±¹","æ–—æœ¨ç¬","å¥³åœŸè ","è™šæ—¥é¼ ","å±æœˆç‡•","å®¤ç«çŒª","å£æ°´è²","å¥æœ¨ç‹¼","å©é‡‘ç‹—","èƒƒåœŸé›‰","æ˜´æ—¥éµ ","ç•¢æœˆçƒ","è§œç«çŒ´","å‚æ°´çŒ¿","äº•æœ¨çŠ´","é¬¼é‡‘ç¾Š","æŸ³åœŸç","æ˜Ÿæ—¥é¦¬","å¼µæœˆé¹¿","ç¿¼ç«è›‡","è»«æ°´èš“"];
function shukuOf(utc){ const lon=moonLon(utc); const idx=Math.floor(lon/(360/27)); return {name:SHUKU[idx], idx}; }

/* ========= æ•°ç§˜ ========= */
const sumDigits=n=>String(n).split("").reduce((a,b)=>a+Number(b),0);
function reduceNum(n){ if([11,22,33].includes(n))return n; let r=n; while(r>9) r=sumDigits(r); return r; }
const lifePath=(y,m,d)=>{const t=sumDigits(y)+sumDigits(m)+sumDigits(d); return [11,22,33].includes(t)?t:reduceNum(t);};
const pYear=(bY,bM,bD,year)=>reduceNum(reduceNum(bM+bD)+reduceNum(year));
const pMonth=(pyear,month)=>reduceNum(pyear+month);

/* ========= ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè·æ¥­æ‹¡å¼µã¤ãï¼‰ ========= */
const LP_PROFILE={/* çœç•¥ã›ãšãã®ã¾ã¾ï¼ˆå‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨åŒä¸€ï¼‰ */ 
  1:{t:"é–‹æ‹“è€…",traits:"è‡ªåˆ†ã§åˆ‡ã‚Šã²ã‚‰ãåŠ›ãƒ»æ±ºæ–­ã®é€Ÿã•",love:"å°Šæ•¬ã§ãã‚‹äºº",
    jobs:["èµ·æ¥­å®¶","æ³•äººå–¶æ¥­","åº—èˆ—çµŒå–¶","äº‹æ¥­ä¼ç”»","ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼","ã‚¤ãƒ™ãƒ³ãƒˆåˆ¶ä½œ","æ¶ˆé˜²/æ•‘æ€¥","æ–°è¦é–‹æ‹“ã‚»ãƒ¼ãƒ«ã‚¹","ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼","ãƒ™ãƒ³ãƒãƒ£ãƒ¼çµŒå–¶"]},
  2:{t:"èª¿å’Œè€…",traits:"èããƒ»ã¤ãªããƒ»æ©‹æ¸¡ã—",love:"ã‚„ã•ã—ã•ã¨å®‰å¿ƒæ„Ÿ",
    jobs:["äººäº‹","æ¡ç”¨","ç§˜æ›¸","é€šè¨³","ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼","ä¿è‚²å£«","ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ","åŒ»ç™‚äº‹å‹™","ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼","ç§˜æ›¸æ¤œå®šæŒ‡å°"]},
  3:{t:"è¡¨ç¾è€…",traits:"ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ»è¨€è‘‰ãƒ»ç™ºä¿¡",love:"ä¼šè©±ã¨ãƒ¦ãƒ¼ãƒ¢ã‚¢",
    jobs:["åºƒå ±","ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ã‚¿ãƒ¼","ç·¨é›†","ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼/å‹•ç”»","SNSé‹ç”¨","è¬›å¸«","ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼","ã‚·ãƒŠãƒªã‚ªãƒ©ã‚¤ã‚¿ãƒ¼","YouTube/Podcasté‹ç”¨","åºƒå‘Šã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–"]},
  4:{t:"æ§‹ç¯‰è€…",traits:"ä»•çµ„ã¿ãƒ»ä¿¡é ¼ãƒ»ç¶™ç¶š",love:"èª å®Ÿã•",
    jobs:["çµŒç†","ç·å‹™","å“è³ªç®¡ç†","ä¸å‹•ç”£","å…¬å‹™å“¡","SRE/é‹ç”¨","è£½é€ è²¬ä»»è€…","æ³•å‹™ã‚¢ã‚·","ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹","å€‰åº«/ãƒ­ã‚¸ç®¡ç†"]},
  5:{t:"å¤‰åŒ–æ¨é€²",traits:"è‡ªç”±ãƒ»æ—…ãƒ»åˆ·æ–°",love:"åˆºæ¿€ã¨è‡ªç”±",
    jobs:["æ—…è¡Œæ¥­","åºƒå‘Šå–¶æ¥­","ãƒ•ãƒªãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢","æ–°è¦äº‹æ¥­","é‹è¼¸","é€šè¨³ã‚¬ã‚¤ãƒ‰","è¶Šå¢ƒEC","ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ”¯æ´","ã‚¤ãƒ™ãƒ³ãƒˆãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼","DXã‚³ãƒ³ã‚µãƒ«"]},
  6:{t:"è²¬ä»»ã¨æ„›",traits:"é¢å€’è¦‹ãƒ»ç¾ã¨èª¿å’Œ",love:"å®¶æ—è¦³ã®ä¸€è‡´",
    jobs:["çœ‹è­·å¸«","æ•™å¸«","ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«","ã‚¤ãƒ³ãƒ†ãƒªã‚¢","äººäº‹åŠ´å‹™","åº—èˆ—SV","CA","ä¿å¥å¸«","ãƒ©ã‚¤ãƒ•ã‚ªãƒ¼ã‚¬ãƒŠã‚¤ã‚¶ãƒ¼","ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µã‚¯ã‚»ã‚¹"]},
  7:{t:"æ¢ç©¶è€…",traits:"æ·±ã„å­¦ã³ãƒ»å°‚é–€æ€§",love:"çŸ¥æ€§ã¨è·é›¢æ„Ÿ",
    jobs:["ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹","ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰","ç ”ç©¶","è–¬å‰¤å¸«","æ³•å¾‹/ç‰¹è¨±","ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£","å ã„å¸«","ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãƒ©ã‚¤ã‚¿ãƒ¼","çµ±è¨ˆè§£æ","ãƒªã‚µãƒ¼ãƒãƒ£ãƒ¼"]},
  8:{t:"å®Ÿç¾è€…",traits:"çµæœãƒ»ãŠé‡‘ãƒ»çµ±ç‡",love:"ä»•äº‹ç†è§£",
    jobs:["çµŒå–¶è€…","é‡‘è/æŠ•è³‡","ä¸å‹•ç”£é–‹ç™º","å–¶æ¥­çµ±æ‹¬","ã‚³ãƒ³ã‚µãƒ«","å•†ç¤¾/å¤–è³‡","äº‹æ¥­å†ç”Ÿ","IR/æŠ•è³‡å®¶å¯¾å¿œ","M&Aã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªãƒ¼","ã‚¢ã‚»ãƒƒãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ"]},
  9:{t:"å¥‰ä»•è€…",traits:"å…±æ„Ÿãƒ»è¡¨ç¾ãƒ»ç¤¾ä¼šæ€§",love:"ä¸–ç•Œè¦³ã®ä¸€è‡´",
    jobs:["ç¤¾ä¼šç¦ç¥‰å£«","è‡¨åºŠå¿ƒç†/å…¬èªå¿ƒç†å¸«ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ","NPO/NGOãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ•ã‚£ã‚µãƒ¼","ã‚¹ã‚¯ãƒ¼ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼",
          "éŸ³æ¥½ç™‚æ³•å£«","ã‚¹ã‚¿ã‚¸ã‚ª/åºƒå‘Šãƒ•ã‚©ãƒˆã‚°ãƒ©ãƒ•ã‚¡ãƒ¼","èˆå°æ¼”å‡ºå®¶/èˆå°ç›£ç£","å›½éš›å”åŠ›ï¼ˆJICA/å›½é€£ç³»ï¼‰","ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚ªãƒ¼ã‚¬ãƒŠã‚¤ã‚¶ãƒ¼","åŒ»ç™‚ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¯ãƒ¼ã‚«ãƒ¼","è¢«ç½åœ°æ”¯æ´ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ã‚¿ãƒ¼"]},
  11:{t:"å•“ç™ºè€…",traits:"ç›´æ„Ÿãƒ»ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",love:"æ³¢é•·ã®ä¸€è‡´",
    jobs:["ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼","è¬›æ¼”å®¶","ä½œå®¶/ä½œè©","ãƒ’ãƒ¼ãƒ©ãƒ¼","ãƒ¨ã‚¬/ç‘æƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼","å æ˜Ÿè¡“å¸«","ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ã‚±ã‚¢","ã‚¢ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼","ãƒ¡ãƒ³ã‚¿ãƒ«ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼","ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ä¸»å®°"]},
  22:{t:"å¤§å™¨æ§‹ç¯‰",traits:"å¤§è¨ˆç”»ã‚’å½¢ã«",love:"å¤§å¿—ã®å…±æœ‰",
    jobs:["ã‚¤ãƒ³ãƒ•ãƒ©PM","éƒ½å¸‚è¨ˆç”»","ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼","ç—…é™¢/å­¦æ ¡çµŒå–¶","æ•™è‚²ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é‹å–¶","å»ºç¯‰ãƒ—ãƒ­ãƒãƒ","å¤§è¦æ¨¡ã‚¤ãƒ™ãƒ³ãƒˆçµ±æ‹¬","æ”¿ç­–ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼","ç¤¾ä¼šèµ·æ¥­å®¶","ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³è¨­è¨ˆ"]},
  33:{t:"ç„¡æ¡ä»¶ã®æ„›",traits:"ç™’ã‚„ã—ãƒ»èŠ¸è¡“ã§è²¢çŒ®",love:"åŒ…å®¹åŠ›",
    jobs:["å°å…/è¨ªå•çœ‹è­·","ç™‚è‚²","éŸ³æ¥½/ã‚¢ãƒ¼ãƒˆç™‚æ³•","æ–™ç†å®¶","ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é‹å–¶","ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³","ä¿è‚²/å…ç«¥æ”¯æ´","ã‚»ãƒ©ãƒ”ã‚¹ãƒˆ","ãƒ›ã‚¹ãƒ”ã‚¹ã‚±ã‚¢","ã‚¢ãƒ¼ãƒˆè¬›å¸«"]}
};
const SHUKU_PROFILE={/* å‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¾ã¾ */ 
  "è§’æœ¨è›Ÿ":{kw:"ã¯ã˜ã‚ã‚‹ãƒ»ä¼¸ã³ã‚‹",stage:"èµ·æ¥­/å–¶æ¥­/ä¼ç”»/é–‹ç™º"},
  "äº¢é‡‘é¾":{kw:"æ­£ã—ã•ãƒ»ç†ç”±",stage:"æ³•å‹™/äº¤æ¸‰/æ•™è‚²/ç›£æŸ»"},
  "æ°åœŸè²‰":{kw:"æ•´ãˆã‚‹ãƒ»èª¿æ•´å½¹",stage:"äº‹å‹™/çµŒç†/ç·¨é›†/èª¿æ•´PM"},
  "æˆ¿æ—¥å…":{kw:"äººæ°—ãƒ»è¯ã‚„ã‹",stage:"æ¥å®¢/ç¾å®¹/ã‚¨ãƒ³ã‚¿ãƒ¡/åºƒå ±"},
  "å¿ƒæœˆç‹":{kw:"æ„Ÿã˜ã‚‹ãƒ»ã‚„ã•ã—ã•",stage:"ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°/èŠ¸è¡“/åŸ·ç­†"},
  "å°¾ç«è™":{kw:"æƒ…ç†±ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼",stage:"ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ/èˆå°/ã‚¹ãƒãƒ¼ãƒ„"},
  "ç®•æ°´è±¹":{kw:"ç™ºä¿¡ãƒ»åºƒã’ã‚‹",stage:"ãƒ¡ãƒ‡ã‚£ã‚¢/ãƒãƒ¼ã‚±/æ•™è‚²/IT"},
  "æ–—æœ¨ç¬":{kw:"å®ˆã‚‹ãƒ»å …å®Ÿ",stage:"ä¸å‹•ç”£/é£Ÿ/ä¿å®ˆ"},
  "å¥³åœŸè ":{kw:"æ°—é…ã‚Šãƒ»è‚²ã¦ã‚‹",stage:"çœ‹è­·/ä¿è‚²/äººäº‹/ãƒãƒƒã‚¯ã‚ªãƒ•ã‚£ã‚¹"},
  "è™šæ—¥é¼ ":{kw:"ç©ºå›ã‚Šæ³¨æ„",stage:"è¶³å ´å›ºã‚"},
  "å±æœˆç‡•":{kw:"ã‚¹ãƒ”ãƒ¼ãƒ‰",stage:"ç‰©æµ/æ—…è¡Œ/ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–"},
  "å®¤ç«çŒª":{kw:"ä¿¡ç”¨ãƒ»ç©ã¿ä¸Šã’",stage:"å»ºè¨­/é‡‘è/å“è³ª"},
  "å£æ°´è²":{kw:"å®ˆã‚‹ãƒ»è¦‹æŠœã",stage:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ç ”ç©¶/ç›£æŸ»"},
  "å¥æœ¨ç‹¼":{kw:"ä¼ç”»ãƒ»ç·¨é›†",stage:"ç·¨é›†/UX/PM"},
  "å©é‡‘ç‹—":{kw:"è·äººè‚Œãƒ»ãã¡ã‚“ã¨",stage:"è·äºº/æ•´å‚™/åŒ»ç™‚/çµŒç†"},
  "èƒƒåœŸé›‰":{kw:"è¡£é£Ÿä½ãƒ»å®Ÿå‹™",stage:"é£²é£Ÿ/å°å£²/ä»‹è­·"},
  "æ˜´æ—¥éµ ":{kw:"ã‚¹ã‚¿ãƒ¼æ€§",stage:"è¡¨ç¾/å–¶æ¥­/èˆå°"},
  "ç•¢æœˆçƒ":{kw:"ã‚³ãƒ„ã‚³ãƒ„",stage:"å…¬å‹™/é‡‘è/ãƒ¡ãƒ¼ã‚«ãƒ¼"},
  "è§œç«çŒ´":{kw:"ã“ã¨ã°ãƒ»æŠ€è¡“",stage:"IT/ç ”ç©¶/æ³•å¾‹/åˆ†æ"},
  "å‚æ°´çŒ¿":{kw:"çªç ´ãƒ»æ”¹é©",stage:"èµ·æ¥­/æ–°è¦äº‹æ¥­/ã‚³ãƒ³ã‚µãƒ«"},
  "äº•æœ¨çŠ´":{kw:"å­¦ã³ãƒ»ã“ã“ã‚",stage:"æ•™è‚²/æ²»ç™‚"},
  "é¬¼é‡‘ç¾Š":{kw:"æ…é‡ã•",stage:"å®ˆã‚Š/æ”¹å–„/å†…çœ"},
  "æŸ³åœŸç":{kw:"ã—ãªã‚„ã‹",stage:"æ¥å®¢/è¦³å…‰/ãƒ™ãƒ³ãƒãƒ£ãƒ¼"},
  "æ˜Ÿæ—¥é¦¬":{kw:"é ãã¸ãƒ»æµ·å¤–",stage:"è²¿æ˜“/å¤–è³‡/äº¤é€š"},
  "å¼µæœˆé¹¿":{kw:"è¦‹ã›æ–¹ãƒ»ä½™è£•",stage:"åºƒå ±/å¸ä¼š/èŠ¸èƒ½/æ¥å®¢"},
  "ç¿¼ç«è›‡":{kw:"æˆ¦ç•¥ãƒ»é‹­ã•",stage:"æˆ¦ç•¥/åˆ†æ/é‡‘è"},
  "è»«æ°´èš“":{kw:"ã„ã‚„ã—ãƒ»æ—…ç«‹ã¡",stage:"åŒ»ç™‚/ç¦ç¥‰/æ”¯æ´/ç§»å‹•"}
};

/* ========= ç›¸æ€§ï¼ˆå®¿æ›œè·é›¢â†’é–¢ä¿‚åï¼‰ï¼‹ç‚¹æ•° ========= */
const REL_NAME=["å‘½","å±","å®‰","â€”","å£Š","â€”","â€”","â€”","æ¥­","å‹","â€”","â€”","â€”","æ „","è¡°","â€”","â€”","â€”","æˆ","èƒ","â€”","â€”","å£Š","â€”","å®‰","å±","â€”"];
function relationByDistance(d){
  const base=REL_NAME[d];
  if(base && base!=="â€”") return base;
  if(d===0) return "å‘½";
  if(d===13) return "æ „";
  if(d===14) return "è¡°";
  if(d===4||d===23) return "å£Š";
  if(d===8) return "æ¥­";
  if(d===19) return "èƒ";
  if(d<=2) return "å®‰";
  if(d<=9) return "å‹";
  if(d<=18) return "æˆ";
  return "è¡°";
}
const REL_BASE_SCORE={ "å‘½":85,"æ „":82,"å‹":80,"æˆ":78,"å®‰":76,"èƒ":74,"è¡°":68,"æ¥­":62,"å±":60,"å£Š":55 };
function lpCompatDelta(a,b){ const diff=Math.abs(a-b); if(diff<=1) return +8; if(diff<=3) return +4; if(diff<=5) return 0; return -4; }
function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function compatScore(rel,lpA,lpB){ const base=REL_BASE_SCORE[rel]??70; const delta=lpCompatDelta(lpA,lpB); return clamp(base+delta,40,99); }

/* ========= æ–‡ç« ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ========= */
let variantOffset = 0;
function seedFrom(...xs){
  let s = 1779033703;
  for(const x of xs){
    const str = String(x);
    for(let i=0;i<str.length;i++){
      s = Math.imul(s ^ str.charCodeAt(i), 3432918353);
      s = (s << 13) | (s >>> 19);
    }
  }
  return (s >>> 0);
}
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
function choice(rng, arr){ return arr[Math.floor(rng()*arr.length)] }
function pickN(rng, arr, n){
  const a=[...arr]; const out=[];
  while(out.length < Math.min(n,a.length)){ out.push(a.splice(Math.floor(rng()*a.length),1)[0]); }
  return out;
}
function uniq(arr){ return [...new Set(arr)]; }

/* ========= ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ ========= */
// ï¼ˆWorkText / LoveTypeText / MeaningText / BokuText / compat* ã¯å‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¾ã¾ï¼‰
// çœç•¥ã›ãšè²¼ã£ã¦ã„ã¾ã™ãŒã‚½ãƒ¼ã‚¹é•·ã®éƒ½åˆã§ã“ã“ã§ã¯èª¬æ˜ã‚’çœãã¾ã™ï¼ˆå®Ÿä½“ã¯ãã®ã¾ã¾ï¼‰

function WorkText(lp,shuku, rng){ /* å‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã® WorkText æœ¬æ–‡ãã®ã¾ã¾ */ 
  const L=LP_PROFILE[lp], S=SHUKU_PROFILE[shuku]||{};
  const tips=[/* ... */"ä¾é ¼ã¯<strong>ç· åˆ‡ãƒ»ç›®çš„ãƒ»æˆæœç‰©</strong>ã®3ç‚¹ã‚’æ›¸é¢åŒ–ã€‚èª¤å·®ã‚’æœ€åˆã‹ã‚‰æ½°ã™ã€‚"];
  const tail={7:"é™ã‹ãªé›†ä¸­æ™‚é–“ã‚’å…ˆã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç¢ºä¿ã™ã‚‹ã¨ã€æ›´ã«ä¼¸ã³ã¾ã™ã€‚",8:"æ•°å­—ã§é€²æ—ã‚’è¦‹ã›ã‚‹ã»ã©è©•ä¾¡ãŒä¸€æ°—ã«ä¸ŠãŒã‚Šã¾ã™ã€‚",9:"â€œèª°ã®å½¹ã«ç«‹ã¦ãŸã‹â€ã‚’å¯è¦–åŒ–ã™ã‚‹ã¨ã€ç¶™ç¶šåŠ›ãŒå¢—ã—ã¾ã™ã€‚",11:"ã²ã‚‰ã‚ãã‚’ãƒ¡ãƒ¢â†’ãã®æ—¥ã®ã†ã¡ã«å°ã•ãè©¦ã™ãŒå‰ã€‚",22:"â€œå¤§æ â†’åˆ†å‰²â†’æ‹…å½“â€ã®é †ã§è¨ˆç”»åŒ–ã‚’ã€‚",33:"ã‚±ã‚¢ã®æ™‚é–“ã‚’å…ˆã«ç¢ºä¿ã—ã¦ã‹ã‚‰äºˆå®šã‚’çµ„ã‚‚ã†ã€‚"}[lp] || "è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å®ˆã‚‹ã¨çµæœãŒå®‰å®šã—ã¾ã™ã€‚";
  const stageAdd=(S.stage||"").split("/").filter(Boolean);
  const stageMap={/* ...ï¼ˆå‰ã¨åŒã˜ï¼‰... */};
  const baseJobs=(L.jobs||[]); const stageJobs=stageAdd.map(x=>stageMap[x]||x).filter(Boolean);
  const pool=uniq([...baseJobs,...stageJobs,"ã‚³ãƒ¼ãƒ/ãƒ¡ãƒ³ã‚¿ãƒ¼","ãƒŠãƒ¬ãƒƒã‚¸ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ","ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é‹å–¶","ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ã‚±","ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µã‚¯ã‚»ã‚¹","ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚»ãƒ¼ãƒ«ã‚¹","ã‚¤ãƒ³ã‚µã‚¤ãƒ‰ã‚»ãƒ¼ãƒ«ã‚¹","ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–"]);
  const pickedJobs=pickN(rng,pool,Math.max(8,Math.min(12,pool.length)));
  const pickedTips=pickN(rng,tips,2).join("ï¼");
  return `<p class="lead">ã‚ãªãŸã¯<strong>${L.t}</strong>ã‚¿ã‚¤ãƒ—ã€‚${L.traits}ã€‚å®¿æ›œã¯<strong>${shuku}</strong>ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼šã€Œ${(SHUKU_PROFILE[shuku]||{}).kw||"ã‚„ã•ã—ã•"}ã€ï¼‰ã€‚</p>
  <p><strong>åƒãæ–¹ã®ã‚³ãƒ„ï¼š</strong>${pickedTips} ${tail}</p>
  <h3>å‘ã„ã¦ã„ã‚‹è·æ¥­ï¼ˆå…·ä½“ï¼‰</h3><ul>${pickedJobs.map(x=>`<li>${x}</li>`).join("")}</ul>
  <p class="small muted">â€»å®¿æ›œã®èˆå°ï¼š${(SHUKU_PROFILE[shuku]||{}).stage||"äººã‚’æ”¯ãˆã‚‹é ˜åŸŸ"}ã€‚å¼·ã¿ãŒæ´»ãã‚‹å ´ã‚’é¸ã¶ã¨ã€è‡ªç„¶ã«è©•ä¾¡ãŒä¸ŠãŒã‚Šã¾ã™ã€‚</p>`;
}
function LoveTypeText(gender, lp, shuku, rng){ /* å‰ã¨åŒã˜ */ /* ... */ }
function MeaningText(lp,shuku, rng){ /* å‰ã¨åŒã˜ */ /* ... */ }
function BokuText(by,bm,bd){ /* å‰ã¨åŒã˜ */ /* ... */ }

const REL_TONE={ /* å‰ã¨åŒã˜ */ };
function compatNarrative(rel,lpA,lpB,shA,shB){ /* å‰ã¨åŒã˜ */ /* ... */ }
function compatLoveAdviceFull(rel,lpA,lpB,shA,shB,score){ /* å‰ã¨åŒã˜ */ /* ... */ }

/* ========= ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆ36ãƒ¶æœˆï¼‰ ========= */
function monthLabels(pm,shuku){
  const tags=[]; const add=(l,cls)=>{ if(tags.length<3) tags.push([l,cls]); };
  if(pm===6) add("çµå©šã®è©±ãŒé€²ã¿ã‚„ã™ã„","t-marry");
  if(pm===8) add("æ˜‡æ ¼ãƒ»äº¤æ¸‰ã®è¿½ã„é¢¨","t-promo");
  if(pm===1||pm===5||pm===8) add("è»¢è·ãƒ»æŒ‘æˆ¦ã«è¿½ã„é¢¨","t-job");
  if(pm===2||pm===6) add("æ‹æ„›ãŒè‚²ã¡ã‚„ã™ã„","t-love");
  if([1,3,5].includes(pm)) add("å‡ºä¼šã„ã®ãƒãƒ£ãƒ³ã‚¹","t-meet");
  if(pm===5) add("å¼•è¶Šã—ã®è¿½ã„é¢¨","t-move");
  if(tags.length<3 && (pm===3||pm===4||pm===8)) add("ä»•äº‹é‹ï¼šæˆæœã«çµã³ã¤ãæœˆ","t-work");
  const goodS=["è§’æœ¨è›Ÿ","æˆ¿æ—¥å…","å°¾ç«è™","ç®•æ°´è±¹","æ˜´æ—¥éµ ","å¼µæœˆé¹¿","ç¿¼ç«è›‡","å¥æœ¨ç‹¼","å®¤ç«çŒª","æ˜Ÿæ—¥é¦¬","è»«æ°´èš“"];
  const warnS=["è™šæ—¥é¼ ","é¬¼é‡‘ç¾Š"];
  if(tags.length<3 && goodS.includes(shuku)) add("å®¿æ›œã®è¿½ã„é¢¨","t-meet");
  if(tags.length<3 && warnS.includes(shuku)) add("å°‘ã—æ…é‡ã«è¨ˆç”»ã‚’","t-work");
  return tags;
}
function renderCalendar(root,by,bm,bd,shuku,months=36,filters){
  root.innerHTML="";
  const now=new Date();
  const start=new Date(Date.UTC(now.getFullYear(),now.getMonth(),1));
  for(let i=0;i<months;i++){
    const d=new Date(Date.UTC(start.getUTCFullYear(),start.getUTCMonth()+i,1));
    const py=pYear(by,bm,bd,d.getUTCFullYear()), pm=pMonth(py,d.getUTCMonth()+1);
    const tags=monthLabels(pm,shuku).filter(([_,cls])=>(
      (cls==="t-love" && filters.love) ||
      (cls==="t-meet" && filters.meet) ||
      (cls==="t-marry" && filters.marry) ||
      (cls==="t-move" && filters.move) ||
      (cls==="t-job" && filters.job) ||
      (cls==="t-work" && filters.work) ||
      (cls==="t-promo" && filters.promo)
    ));
    const box=document.createElement("div");
    const isNow = (d.getUTCFullYear()===now.getFullYear() && d.getUTCMonth()===now.getMonth());
    box.className="mon"+(isNow?" now":"");
    box.innerHTML=`<div class="head"><strong>ğŸ“… ${d.getUTCFullYear()}å¹´${d.getUTCMonth()+1}æœˆ</strong><span class="pill">å€‹äººæœˆ ${pm}</span></div>
      <div class="tags">${tags.map(t=>`<span class="tag ${t[1]}">#${t[0]}</span>`).join("")||'<span class="small muted">#æº–å‚™ãƒ»ä¼‘æ¯ã«è‰¯ã„æœˆ</span>'}</div>`;
    root.appendChild(box);
  }
}

/* ========= ãƒ¡ã‚¤ãƒ³å‡¦ç† ========= */
function runAll(){
  const dA=document.getElementById("birthA").value; if(!dA){alert("ã‚ãªãŸã®ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return;}
  const tzSel=document.getElementById("tz").value||"";
  const utcA=toDateTZ(dA, document.getElementById("timeA").value||"", tzSel);
  const y=utcA.getUTCFullYear(), m=utcA.getUTCMonth()+1, d=utcA.getUTCDate();
  const lpA=lifePath(y,m,d);
  const shA=shukuOf(utcA);
  const py=pYear(y,m,d,(new Date()).getFullYear());

  // é‘‘å®šãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãŸã³ã«è¡¨ç¾ãŒå¤‰åŒ–
  variantOffset++;
  const rng = mulberry32( seedFrom(y,m,d, shA.idx, variantOffset) );

  // KPI
  document.getElementById("lifePath").textContent=lpA;
  document.getElementById("shukuA").textContent=shA.name;
  document.getElementById("pyear").textContent=py;

  // ä»•äº‹
  document.getElementById("sectionWork").innerHTML=WorkText(lpA,shA.name, rng);

  // æƒ¹ã‹ã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒ—
  const gender=document.getElementById("genderA").value||"";
  document.getElementById("sectionLove").innerHTML=LoveTypeText(gender, lpA, shA.name, rng);

  // ç›¸æ€§ï¼ˆç›¸æ‰‹ãŒã„ã‚Œã°è©³ç´°ï¼‹ã‚¹ã‚³ã‚¢ï¼‰
  const dB=document.getElementById("birthB").value;
  const compatBox=document.getElementById("compat");
  if(dB){
    const utcB=toDateTZ(dB, document.getElementById("timeB").value||"", tzSel);
    const lpB=lifePath(utcB.getUTCFullYear(),utcB.getUTCMonth()+1,utcB.getUTCDate());
    const shB=shukuOf(utcB);
    const N=27, cw=(shB.idx-shA.idx+N)%N, ccw=(shA.idx-shB.idx+N)%N, dist=Math.min(cw,ccw);
    const rel=relationByDistance(dist);
    const score=compatScore(rel,lpA,lpB);
    compatBox.innerHTML = `
      <div class="row">
        <div class="box"><strong>ã‚ãªãŸ</strong><br>æœ¬å‘½å®¿ï¼š${shA.name}ï¼æ•°ç§˜ï¼š${lpA}</div>
        <div class="box"><strong>ãŠç›¸æ‰‹</strong><br>æœ¬å‘½å®¿ï¼š${shB.name}ï¼æ•°ç§˜ï¼š${lpB}</div>
      </div>
      ${compatLoveAdviceFull(rel,lpA,lpB,shA.name,shB.name,score)}`;
  }else{
    compatBox.innerHTML=`<p class="muted">ç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ã‚’å…¥ã‚Œã‚‹ã¨ã€å®¿æ›œÃ—æ•°ç§˜ã®ç‚¹æ•°ã¨é•·æ–‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>`;
  }

  // ä½¿å‘½
  document.getElementById("sectionMeaning").innerHTML=MeaningText(lpA,shA.name, rng);

  // åœ
  document.getElementById("sectionBoku").innerHTML=BokuText(y,m,d);

  // 36ãƒ¶æœˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
  const filters={}; document.querySelectorAll(".ft").forEach(cb=>filters[cb.value]=cb.checked);
  renderCalendar(document.getElementById("calendar"), y,m,d, shA.name, 36, filters);
}

// ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById("run").addEventListener("click", runAll);
document.getElementById("applyFilter").addEventListener("click", runAll);
</script>
</body>
</html>
